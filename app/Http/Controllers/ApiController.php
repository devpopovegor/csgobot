<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        set_time_limit(0);
        $patterns = json_decode('[{"paintseed":"601","item":"12753644505"},{"paintseed":"601","item":"4966311131"},{"paintseed":"601","item":"12914628406"},{"paintseed":"601","item":"12162587260"},{"paintseed":"601","item":"12664336450"},{"paintseed":"601","item":"12830620128"},{"paintseed":"601","item":"12811758637"},{"paintseed":"601","item":"3575352170"},{"paintseed":"601","item":"12377975458"},{"paintseed":"601","item":"7674750559"},{"paintseed":"417","item":"3952474634"},{"paintseed":"417","item":"8082007009"},{"paintseed":"417","item":"11798687177"},{"paintseed":"417","item":"6323632329"},{"paintseed":"417","item":"11672143438"},{"paintseed":"417","item":"8097161817"},{"paintseed":"58","item":"12935297079"},{"paintseed":"58","item":"12630594698"},{"paintseed":"58","item":"12753082481"},{"paintseed":"58","item":"12296024153"},{"paintseed":"403","item":"11426973713"},{"paintseed":"523","item":"7873254736"},{"paintseed":"523","item":"9415805236"},{"paintseed":"523","item":"7742508027"},{"paintseed":"523","item":"12547264814"},{"paintseed":"523","item":"10300544217"},{"paintseed":"150","item":"12416748131"},{"paintseed":"349","item":"12718296268"},{"paintseed":"349","item":"12670400720"},{"paintseed":"349","item":"8524100135"},{"paintseed":"349","item":"2173567196"},{"paintseed":"349","item":"7365867854"},{"paintseed":"349","item":"7537013843"},{"paintseed":"349","item":"12381469360"},{"paintseed":"634","item":"10206773536"},{"paintseed":"634","item":"12064563177"},{"paintseed":"634","item":"12519686832"},{"paintseed":"634","item":"11733889422"},{"paintseed":"634","item":"11533676441"},{"paintseed":"634","item":"1553879284"},{"paintseed":"239","item":"12641513344"},{"paintseed":"239","item":"140133264"},{"paintseed":"239","item":"12913238523"},{"paintseed":"897","item":"4160345292"},{"paintseed":"897","item":"10215664513"},{"paintseed":"897","item":"12883270366"},{"paintseed":"897","item":"12156526321"},{"paintseed":"897","item":"3991450997"},{"paintseed":"503","item":"11535209252"},{"paintseed":"503","item":"12874249389"},{"paintseed":"503","item":"12894770360"},{"paintseed":"503","item":"2591507651"},{"paintseed":"503","item":"12930590307"},{"paintseed":"354","item":"8693730521"},{"paintseed":"354","item":"7327202539"},{"paintseed":"354","item":"11986913287"},{"paintseed":"354","item":"6313020230"},{"paintseed":"107","item":"12645468698"},{"paintseed":"107","item":"11619322261"},{"paintseed":"107","item":"10179122714"},{"paintseed":"107","item":"4193405171"},{"paintseed":"107","item":"4336747479"},{"paintseed":"449","item":"2364956252"},{"paintseed":"449","item":"12508264502"},{"paintseed":"449","item":"9194735521"},{"paintseed":"585","item":"5406324255"},{"paintseed":"585","item":"12234235701"},{"paintseed":"585","item":"12750901801"},{"paintseed":"585","item":"85105853"},{"paintseed":"585","item":"7352065466"},{"paintseed":"585","item":"10495217955"},{"paintseed":"281","item":"10041436979"},{"paintseed":"281","item":"12558446030"},{"paintseed":"281","item":"9431001607"},{"paintseed":"281","item":"12886983738"},{"paintseed":"281","item":"2495441996"},{"paintseed":"281","item":"6422985113"},{"paintseed":"224","item":"3998091677"},{"paintseed":"224","item":"11938782404"},{"paintseed":"224","item":"12757655302"},{"paintseed":"224","item":"11862278342"},{"paintseed":"946","item":"1663053805"},{"paintseed":"946","item":"11425948569"},{"paintseed":"946","item":"11209244969"},{"paintseed":"946","item":"4656239357"},{"paintseed":"946","item":"9106087695"},{"paintseed":"517","item":"12878542621"},{"paintseed":"517","item":"203041366"},{"paintseed":"517","item":"12711222634"},{"paintseed":"517","item":"12619961059"},{"paintseed":"517","item":"12332904490"},{"paintseed":"517","item":"12819723744"},{"paintseed":"253","item":"9176600155"},{"paintseed":"253","item":"10470684501"},{"paintseed":"253","item":"11508124037"},{"paintseed":"793","item":"5444712162"},{"paintseed":"793","item":"5775776714"},{"paintseed":"793","item":"12793456992"},{"paintseed":"793","item":"11534675012"},{"paintseed":"793","item":"12897888798"},{"paintseed":"715","item":"12912694576"},{"paintseed":"715","item":"12894226901"},{"paintseed":"715","item":"12162147557"},{"paintseed":"715","item":"5657703525"},{"paintseed":"715","item":"2735125425"},{"paintseed":"715","item":"11898783128"},{"paintseed":"715","item":"3303285660"},{"paintseed":"210","item":"12126209419"},{"paintseed":"210","item":"12776366276"},{"paintseed":"210","item":"6861616533"},{"paintseed":"867","item":"12231326453"},{"paintseed":"867","item":"3158750535"},{"paintseed":"867","item":"10552919801"},{"paintseed":"867","item":"6196971537"},{"paintseed":"867","item":"2787376981"},{"paintseed":"837","item":"12404408294"},{"paintseed":"837","item":"12739255811"},{"paintseed":"837","item":"11633501836"},{"paintseed":"406","item":"12366170916"},{"paintseed":"406","item":"12900204779"},{"paintseed":"406","item":"9795343559"},{"paintseed":"167","item":"9496438174"},{"paintseed":"167","item":"3639136253"},{"paintseed":"167","item":"11399613299"},{"paintseed":"167","item":"10536079751"},{"paintseed":"167","item":"8550077277"},{"paintseed":"88","item":"7080160799"},{"paintseed":"88","item":"5407211864"},{"paintseed":"88","item":"9655355507"},{"paintseed":"355","item":"12235822018"},{"paintseed":"355","item":"12345410616"},{"paintseed":"355","item":"1162501133"},{"paintseed":"355","item":"9801586423"},{"paintseed":"355","item":"12464805128"},{"paintseed":"959","item":"7828629080"},{"paintseed":"959","item":"12877920163"},{"paintseed":"959","item":"11004428475"},{"paintseed":"959","item":"12894366051"},{"paintseed":"959","item":"12405436088"},{"paintseed":"336","item":"9113678654"},{"paintseed":"336","item":"12564689462"},{"paintseed":"336","item":"10248250816"},{"paintseed":"336","item":"10671064952"},{"paintseed":"336","item":"12838726463"},{"paintseed":"336","item":"11808799296"},{"paintseed":"632","item":"7573166598"},{"paintseed":"632","item":"1561470845"},{"paintseed":"372","item":"12700483327"},{"paintseed":"372","item":"12237903367"},{"paintseed":"372","item":"12893440985"},{"paintseed":"610","item":"11054420840"},{"paintseed":"610","item":"5686636836"},{"paintseed":"610","item":"12254163790"},{"paintseed":"610","item":"886682145"},{"paintseed":"989","item":"6638986048"},{"paintseed":"989","item":"6054586955"},{"paintseed":"989","item":"4989689822"},{"paintseed":"989","item":"10801514434"},{"paintseed":"989","item":"9675657670"},{"paintseed":"989","item":"10945564729"},{"paintseed":"59","item":"7068836308"},{"paintseed":"59","item":"935668292"},{"paintseed":"59","item":"9160477351"},{"paintseed":"59","item":"12470059824"},{"paintseed":"59","item":"8853260443"},{"paintseed":"59","item":"5419242380"},{"paintseed":"41","item":"2647949617"},{"paintseed":"41","item":"12833039535"},{"paintseed":"41","item":"12863806230"},{"paintseed":"41","item":"3162445579"},{"paintseed":"41","item":"4703553179"},{"paintseed":"41","item":"12296657065"},{"paintseed":"915","item":"12759059366"},{"paintseed":"915","item":"2766171391"},{"paintseed":"915","item":"6570529987"},{"paintseed":"619","item":"12909173636"},{"paintseed":"619","item":"8964352621"},{"paintseed":"619","item":"12885140423"},{"paintseed":"619","item":"9916818868"},{"paintseed":"619","item":"12394209075"},{"paintseed":"619","item":"9718787413"},{"paintseed":"619","item":"12646487393"},{"paintseed":"904","item":"4797395385"},{"paintseed":"904","item":"12715653934"},{"paintseed":"904","item":"5154502336"},{"paintseed":"904","item":"2316733235"},{"paintseed":"811","item":"12873340054"},{"paintseed":"811","item":"5945257366"},{"paintseed":"811","item":"6259526470"},{"paintseed":"811","item":"12764038717"},{"paintseed":"811","item":"9898752843"},{"paintseed":"166","item":"11109106931"},{"paintseed":"166","item":"7004054977"},{"paintseed":"166","item":"12479241746"},{"paintseed":"166","item":"12552286229"},{"paintseed":"166","item":"12912150939"},{"paintseed":"628","item":"12392998430"},{"paintseed":"628","item":"7333564634"},{"paintseed":"628","item":"11583427938"},{"paintseed":"628","item":"9369691998"},{"paintseed":"628","item":"3561490468"},{"paintseed":"628","item":"10668329206"},{"paintseed":"628","item":"9617958281"},{"paintseed":"968","item":"12026044721"},{"paintseed":"968","item":"10872992773"},{"paintseed":"968","item":"10764813339"},{"paintseed":"968","item":"12800605988"},{"paintseed":"968","item":"5489756471"},{"paintseed":"698","item":"5460166806"},{"paintseed":"698","item":"2896731623"},{"paintseed":"698","item":"6949969930"},{"paintseed":"698","item":"2705315773"},{"paintseed":"698","item":"9986324500"},{"paintseed":"550","item":"7375474512"},{"paintseed":"550","item":"10365323582"},{"paintseed":"550","item":"5443265588"},{"paintseed":"550","item":"10644651949"},{"paintseed":"550","item":"12479148574"},{"paintseed":"550","item":"7298450541"},{"paintseed":"550","item":"12421113881"},{"paintseed":"202","item":"11360181254"},{"paintseed":"202","item":"11901357197"},{"paintseed":"202","item":"6323513497"},{"paintseed":"202","item":"11665751210"},{"paintseed":"651","item":"12603485363"},{"paintseed":"651","item":"5410432979"},{"paintseed":"651","item":"5535040667"},{"paintseed":"651","item":"12074796961"},{"paintseed":"651","item":"10228931005"},{"paintseed":"916","item":"12696788685"},{"paintseed":"916","item":"4792289771"},{"paintseed":"916","item":"12845977490"},{"paintseed":"910","item":"7787011141"},{"paintseed":"910","item":"12649007517"},{"paintseed":"910","item":"6298022738"},{"paintseed":"910","item":"12080017292"},{"paintseed":"910","item":"10398974214"},{"paintseed":"366","item":"12360305688"},{"paintseed":"366","item":"3382554355"},{"paintseed":"366","item":"12824822830"},{"paintseed":"366","item":"5439447625"},{"paintseed":"366","item":"7370493591"},{"paintseed":"808","item":"11316981266"},{"paintseed":"808","item":"12873833128"},{"paintseed":"808","item":"4596236757"},{"paintseed":"808","item":"12185585430"},{"paintseed":"808","item":"12028435646"},{"paintseed":"177","item":"11353115366"},{"paintseed":"177","item":"9380496438"},{"paintseed":"177","item":"6824946015"},{"paintseed":"177","item":"11979052686"},{"paintseed":"871","item":"3333563832"},{"paintseed":"871","item":"5298094059"},{"paintseed":"871","item":"8166570707"},{"paintseed":"871","item":"2795722131"},{"paintseed":"871","item":"12756374325"},{"paintseed":"871","item":"12865732914"},{"paintseed":"871","item":"12484265256"},{"paintseed":"871","item":"12810907913"},{"paintseed":"288","item":"12555474323"},{"paintseed":"288","item":"10251778167"},{"paintseed":"288","item":"11040501369"},{"paintseed":"288","item":"10014575101"},{"paintseed":"476","item":"1652971389"},{"paintseed":"476","item":"11477648812"},{"paintseed":"476","item":"9104374434"},{"paintseed":"476","item":"4323058749"},{"paintseed":"292","item":"5371752214"},{"paintseed":"292","item":"11543504383"},{"paintseed":"292","item":"12189468046"},{"paintseed":"292","item":"11132811328"},{"paintseed":"292","item":"7389210326"},{"paintseed":"292","item":"9217099215"},{"paintseed":"292","item":"4557893070"},{"paintseed":"401","item":"12623021899"},{"paintseed":"401","item":"12875637922"},{"paintseed":"401","item":"10057506812"},{"paintseed":"179","item":"12810674169"},{"paintseed":"179","item":"12081289821"},{"paintseed":"179","item":"9704038616"},{"paintseed":"269","item":"10261043476"},{"paintseed":"269","item":"12534733914"},{"paintseed":"269","item":"10428040047"},{"paintseed":"269","item":"11704870958"},{"paintseed":"269","item":"9105250249"},{"paintseed":"351","item":"7314859809"},{"paintseed":"351","item":"10654671775"},{"paintseed":"351","item":"12404073010"},{"paintseed":"351","item":"12856907209"},{"paintseed":"351","item":"10832935423"},{"paintseed":"351","item":"10282059072"},{"paintseed":"430","item":"11824479772"},{"paintseed":"430","item":"12080017350"},{"paintseed":"430","item":"5369264823"},{"paintseed":"430","item":"12271561097"},{"paintseed":"430","item":"9925824380"},{"paintseed":"430","item":"10646438821"},{"paintseed":"430","item":"8956958476"},{"paintseed":"229","item":"9550741598"},{"paintseed":"229","item":"4977850991"},{"paintseed":"229","item":"8932999161"},{"paintseed":"533","item":"9868622115"},{"paintseed":"533","item":"12917194249"},{"paintseed":"533","item":"11827620003"},{"paintseed":"533","item":"7741547451"},{"paintseed":"353","item":"11320585875"},{"paintseed":"353","item":"5740122494"},{"paintseed":"353","item":"8297202520"},{"paintseed":"353","item":"12804612561"},{"paintseed":"353","item":"1068067246"},{"paintseed":"353","item":"12389217608"},{"paintseed":"353","item":"9190409565"},{"paintseed":"413","item":"3111065120"},{"paintseed":"413","item":"11565738594"},{"paintseed":"413","item":"6799287861"},{"paintseed":"413","item":"10038674808"},{"paintseed":"413","item":"5890022128"},{"paintseed":"413","item":"12552286191"},{"paintseed":"413","item":"2923366275"},{"paintseed":"413","item":"12568633789"},{"paintseed":"821","item":"11519704569"},{"paintseed":"821","item":"11964953300"},{"paintseed":"821","item":"10027884048"},{"paintseed":"790","item":"7221447354"},{"paintseed":"790","item":"12506476050"},{"paintseed":"790","item":"9164609180"},{"paintseed":"790","item":"12873910301"},{"paintseed":"790","item":"6489044004"},{"paintseed":"141","item":"2760384772"},{"paintseed":"141","item":"6313189643"},{"paintseed":"141","item":"6358407111"},{"paintseed":"141","item":"2228803275"},{"paintseed":"141","item":"12404540199"},{"paintseed":"141","item":"12882498606"},{"paintseed":"141","item":"5010701817"},{"paintseed":"246","item":"12597243795"},{"paintseed":"246","item":"12420325292"},{"paintseed":"246","item":"7281104311"},{"paintseed":"246","item":"7248922169"},{"paintseed":"246","item":"7398334760"},{"paintseed":"136","item":"1533856805"},{"paintseed":"136","item":"8932573549"},{"paintseed":"136","item":"12626206359"},{"paintseed":"136","item":"11568213713"},{"paintseed":"136","item":"10566290234"},{"paintseed":"136","item":"10017668511"},{"paintseed":"955","item":"5107665647"},{"paintseed":"613","item":"12755058581"},{"paintseed":"613","item":"5699269195"},{"paintseed":"613","item":"9776372163"},{"paintseed":"556","item":"12898621503"},{"paintseed":"556","item":"6603953306"},{"paintseed":"556","item":"12744240852"},{"paintseed":"556","item":"5257362561"},{"paintseed":"794","item":"4746261948"},{"paintseed":"794","item":"11628372310"},{"paintseed":"794","item":"4862887739"},{"paintseed":"526","item":"11441894132"},{"paintseed":"526","item":"7434009934"},{"paintseed":"526","item":"9230942985"},{"paintseed":"526","item":"8463902857"},{"paintseed":"526","item":"11131374091"},{"paintseed":"526","item":"10114806877"},{"paintseed":"173","item":"11033820533"},{"paintseed":"173","item":"12869268624"},{"paintseed":"173","item":"7126034025"},{"paintseed":"108","item":"7575750575"},{"paintseed":"108","item":"12431214366"},{"paintseed":"108","item":"1352555716"},{"paintseed":"108","item":"9145692712"},{"paintseed":"108","item":"11232590788"},{"paintseed":"108","item":"11615887557"},{"paintseed":"108","item":"7168259613"},{"paintseed":"117","item":"12715709732"},{"paintseed":"117","item":"9426443279"},{"paintseed":"117","item":"9955194086"},{"paintseed":"674","item":"4072481395"},{"paintseed":"674","item":"11408037585"},{"paintseed":"674","item":"12080465383"},{"paintseed":"674","item":"5044517433"},{"paintseed":"345","item":"12879210151"},{"paintseed":"345","item":"10509280868"},{"paintseed":"345","item":"10529061841"},{"paintseed":"345","item":"10514990978"},{"paintseed":"345","item":"12040781479"},{"paintseed":"345","item":"3123475938"},{"paintseed":"573","item":"9651048959"},{"paintseed":"573","item":"7036553624"},{"paintseed":"573","item":"5970819247"},{"paintseed":"573","item":"5530462858"},{"paintseed":"573","item":"12595148377"},{"paintseed":"859","item":"11349119223"},{"paintseed":"859","item":"5347569605"},{"paintseed":"859","item":"12696972335"},{"paintseed":"859","item":"12793314269"},{"paintseed":"859","item":"11752417671"},{"paintseed":"859","item":"3555253940"},{"paintseed":"859","item":"12431480113"},{"paintseed":"103","item":"11840842726"},{"paintseed":"103","item":"12379443689"},{"paintseed":"103","item":"12888255868"},{"paintseed":"103","item":"9808983642"},{"paintseed":"103","item":"10805876788"},{"paintseed":"103","item":"12760713925"},{"paintseed":"529","item":"12219161466"},{"paintseed":"529","item":"12571301471"},{"paintseed":"529","item":"9068422447"},{"paintseed":"529","item":"2675141179"},{"paintseed":"529","item":"12738606353"},{"paintseed":"866","item":"12682060732"},{"paintseed":"866","item":"12837329269"},{"paintseed":"866","item":"12896753374"},{"paintseed":"176","item":"11962663391"},{"paintseed":"176","item":"11084654456"},{"paintseed":"176","item":"9814920570"},{"paintseed":"157","item":"3348267631"},{"paintseed":"157","item":"9680580524"},{"paintseed":"157","item":"10202931277"},{"paintseed":"91","item":"11999096331"},{"paintseed":"91","item":"4136991485"},{"paintseed":"91","item":"9453424765"},{"paintseed":"546","item":"4038220408"},{"paintseed":"546","item":"9947901090"},{"paintseed":"546","item":"11210650298"},{"paintseed":"546","item":"12472045627"},{"paintseed":"546","item":"5155710010"},{"paintseed":"546","item":"8746208284"},{"paintseed":"518","item":"12532710379"},{"paintseed":"518","item":"12789153636"},{"paintseed":"518","item":"6489092421"},{"paintseed":"518","item":"9905777479"},{"paintseed":"518","item":"7275741841"},{"paintseed":"518","item":"12803138813"},{"paintseed":"516","item":"12858672210"},{"paintseed":"516","item":"11090247503"},{"paintseed":"516","item":"12274383182"},{"paintseed":"516","item":"12900409075"},{"paintseed":"735","item":"2247947082"},{"paintseed":"735","item":"11053859548"},{"paintseed":"735","item":"12629061044"},{"paintseed":"835","item":"12651498533"},{"paintseed":"835","item":"9960220778"},{"paintseed":"835","item":"8843476633"},{"paintseed":"835","item":"12830710684"},{"paintseed":"835","item":"10351074013"},{"paintseed":"835","item":"11601435968"},{"paintseed":"524","item":"3403301529"},{"paintseed":"524","item":"12757777925"},{"paintseed":"524","item":"12356117788"},{"paintseed":"524","item":"12095301907"},{"paintseed":"524","item":"3439419742"},{"paintseed":"524","item":"12908207436"},{"paintseed":"941","item":"12478094262"},{"paintseed":"941","item":"12442390521"},{"paintseed":"286","item":"12328182006"},{"paintseed":"286","item":"5790180066"},{"paintseed":"286","item":"12867175125"},{"paintseed":"286","item":"12898852609"},{"paintseed":"813","item":"12872600502"},{"paintseed":"813","item":"12784414965"},{"paintseed":"813","item":"11234797869"},{"paintseed":"813","item":"12731915632"},{"paintseed":"813","item":"12874406671"},{"paintseed":"813","item":"9721311630"},{"paintseed":"813","item":"12664585468"},{"paintseed":"813","item":"12321468336"},{"paintseed":"783","item":"10981999933"},{"paintseed":"783","item":"3287059320"},{"paintseed":"124","item":"1624849294"},{"paintseed":"124","item":"8468087431"},{"paintseed":"124","item":"3371305970"},{"paintseed":"124","item":"7554847933"},{"paintseed":"124","item":"12386376890"},{"paintseed":"393","item":"12212992548"},{"paintseed":"393","item":"11918796216"},{"paintseed":"393","item":"12784246800"},{"paintseed":"393","item":"12025932814"},{"paintseed":"393","item":"10048559204"},{"paintseed":"346","item":"12594536451"},{"paintseed":"346","item":"10699581593"},{"paintseed":"346","item":"11504729056"},{"paintseed":"346","item":"11977733257"},{"paintseed":"346","item":"10797218258"},{"paintseed":"369","item":"2288012286"},{"paintseed":"369","item":"4503287465"},{"paintseed":"369","item":"12530519871"},{"paintseed":"369","item":"6772663672"},{"paintseed":"369","item":"6784445358"},{"paintseed":"369","item":"2858050927"},{"paintseed":"759","item":"9769008446"},{"paintseed":"759","item":"12846395087"},{"paintseed":"759","item":"6564161562"},{"paintseed":"97","item":"5466727369"},{"paintseed":"97","item":"5209648954"},{"paintseed":"97","item":"4094309281"},{"paintseed":"475","item":"12825458905"},{"paintseed":"475","item":"12740154181"},{"paintseed":"475","item":"2557187310"},{"paintseed":"475","item":"8235344304"},{"paintseed":"475","item":"12781765027"},{"paintseed":"475","item":"12813356992"},{"paintseed":"293","item":"11951984059"},{"paintseed":"293","item":"12904540150"},{"paintseed":"293","item":"7140647481"},{"paintseed":"293","item":"3918655040"},{"paintseed":"507","item":"9220007690"},{"paintseed":"507","item":"4990064821"},{"paintseed":"507","item":"11908959035"},{"paintseed":"507","item":"12204222967"},{"paintseed":"507","item":"7915946466"},{"paintseed":"507","item":"12887961117"},{"paintseed":"507","item":"11456776883"},{"paintseed":"507","item":"8937454708"},{"paintseed":"507","item":"4092891512"},{"paintseed":"400","item":"9137257230"},{"paintseed":"400","item":"10268146973"},{"paintseed":"400","item":"12366207771"},{"paintseed":"681","item":"8558754057"},{"paintseed":"681","item":"4450115820"},{"paintseed":"681","item":"12408402335"},{"paintseed":"681","item":"2155799911"},{"paintseed":"963","item":"12924769264"},{"paintseed":"963","item":"3851244287"},{"paintseed":"764","item":"10125985187"},{"paintseed":"764","item":"11495405824"},{"paintseed":"764","item":"9223308718"},{"paintseed":"764","item":"6830140089"},{"paintseed":"764","item":"12859102079"},{"paintseed":"764","item":"5187585677"},{"paintseed":"764","item":"8860714411"},{"paintseed":"869","item":"2982974210"},{"paintseed":"869","item":"8416479029"},{"paintseed":"869","item":"12684621017"},{"paintseed":"869","item":"11758003641"},{"paintseed":"869","item":"4966312833"},{"paintseed":"251","item":"2910138292"},{"paintseed":"251","item":"12924929866"},{"paintseed":"902","item":"10406446947"},{"paintseed":"902","item":"12329248334"},{"paintseed":"902","item":"6162937835"},{"paintseed":"902","item":"12409162990"},{"paintseed":"902","item":"10283601771"},{"paintseed":"706","item":"11684441398"},{"paintseed":"308","item":"9924705771"},{"paintseed":"308","item":"8864751195"},{"paintseed":"308","item":"11550904571"},{"paintseed":"308","item":"6485998336"},{"paintseed":"308","item":"12040795198"},{"paintseed":"209","item":"3860531398"},{"paintseed":"209","item":"12616899642"},{"paintseed":"209","item":"6914437668"},{"paintseed":"209","item":"8783462255"},{"paintseed":"4","item":"6633544182"},{"paintseed":"4","item":"12165968492"},{"paintseed":"4","item":"8043914417"},{"paintseed":"4","item":"11413738510"},{"paintseed":"887","item":"7281375825"},{"paintseed":"887","item":"12718522391"},{"paintseed":"887","item":"7371632933"},{"paintseed":"887","item":"9267982215"},{"paintseed":"887","item":"7803058954"},{"paintseed":"887","item":"12086302938"},{"paintseed":"887","item":"5332146151"},{"paintseed":"342","item":"12663258184"},{"paintseed":"342","item":"12685265060"},{"paintseed":"342","item":"3287054869"},{"paintseed":"342","item":"11390310128"},{"paintseed":"296","item":"4922581842"},{"paintseed":"296","item":"5060005427"},{"paintseed":"225","item":"4138820447"},{"paintseed":"225","item":"12013903905"},{"paintseed":"225","item":"9178320100"},{"paintseed":"845","item":"11536314749"},{"paintseed":"845","item":"7176246567"},{"paintseed":"845","item":"11413811168"},{"paintseed":"845","item":"12611244157"},{"paintseed":"845","item":"12537577878"},{"paintseed":"845","item":"9585860604"},{"paintseed":"262","item":"10856520866"},{"paintseed":"262","item":"12838733986"},{"paintseed":"262","item":"12598736248"},{"paintseed":"170","item":"9542268475"},{"paintseed":"170","item":"4498136806"},{"paintseed":"170","item":"9891478913"},{"paintseed":"315","item":"6529261917"},{"paintseed":"315","item":"751015909"},{"paintseed":"315","item":"12738393276"},{"paintseed":"319","item":"9036287481"},{"paintseed":"319","item":"3615301669"},{"paintseed":"319","item":"12557265054"},{"paintseed":"319","item":"10014817011"},{"paintseed":"779","item":"6999465723"},{"paintseed":"779","item":"12542250035"},{"paintseed":"779","item":"12673636109"},{"paintseed":"779","item":"9924478591"},{"paintseed":"162","item":"9337068617"},{"paintseed":"162","item":"12894995085"},{"paintseed":"162","item":"12801997043"},{"paintseed":"162","item":"12334544224"},{"paintseed":"162","item":"6181506424"},{"paintseed":"954","item":"12753994142"},{"paintseed":"954","item":"12426925135"},{"paintseed":"954","item":"6767078890"},{"paintseed":"954","item":"6042946343"},{"paintseed":"608","item":"9604939902"},{"paintseed":"608","item":"2921367549"},{"paintseed":"608","item":"12283057200"},{"paintseed":"608","item":"9595775185"},{"paintseed":"608","item":"9210126927"},{"paintseed":"409","item":"3720508050"},{"paintseed":"409","item":"10954595975"},{"paintseed":"409","item":"8950229451"},{"paintseed":"409","item":"6876512394"},{"paintseed":"409","item":"7418647943"},{"paintseed":"409","item":"12557358250"},{"paintseed":"409","item":"11317152484"},{"paintseed":"63","item":"10919794126"},{"paintseed":"63","item":"12932456349"},{"paintseed":"63","item":"12908287949"},{"paintseed":"63","item":"12414785898"},{"paintseed":"163","item":"6087583625"},{"paintseed":"163","item":"11993516367"},{"paintseed":"163","item":"6538803429"},{"paintseed":"493","item":"10510218691"},{"paintseed":"67","item":"11181829948"},{"paintseed":"67","item":"8605864984"},{"paintseed":"204","item":"4896772261"},{"paintseed":"204","item":"11338459542"},{"paintseed":"204","item":"12858596941"},{"paintseed":"204","item":"3533249438"},{"paintseed":"204","item":"3256823063"},{"paintseed":"569","item":"4691071615"},{"paintseed":"598","item":"10172306959"},{"paintseed":"598","item":"12900948829"},{"paintseed":"496","item":"12695391620"},{"paintseed":"496","item":"2930692302"},{"paintseed":"496","item":"10967979099"},{"paintseed":"496","item":"9039245767"},{"paintseed":"496","item":"8297101974"},{"paintseed":"169","item":"7400483870"},{"paintseed":"169","item":"12744261312"},{"paintseed":"169","item":"12621556477"},{"paintseed":"169","item":"11401804770"},{"paintseed":"580","item":"8192401470"},{"paintseed":"580","item":"12857547482"},{"paintseed":"580","item":"6756236532"},{"paintseed":"580","item":"9182299116"},{"paintseed":"250","item":"7457736955"},{"paintseed":"250","item":"11884514657"},{"paintseed":"668","item":"10472037446"},{"paintseed":"668","item":"12357019585"},{"paintseed":"668","item":"12916735343"},{"paintseed":"668","item":"4635219067"},{"paintseed":"668","item":"11186984197"},{"paintseed":"668","item":"12937272500"},{"paintseed":"31","item":"12934714482"},{"paintseed":"31","item":"8647747405"},{"paintseed":"31","item":"8084251521"},{"paintseed":"537","item":"12334641131"},{"paintseed":"537","item":"12808896668"},{"paintseed":"537","item":"12577128745"},{"paintseed":"537","item":"12701110846"},{"paintseed":"537","item":"12855389467"},{"paintseed":"197","item":"12495637156"},{"paintseed":"197","item":"4034153648"},{"paintseed":"197","item":"8183384080"},{"paintseed":"21","item":"11722129628"},{"paintseed":"21","item":"7367886992"},{"paintseed":"21","item":"10089351278"},{"paintseed":"203","item":"10579749599"},{"paintseed":"203","item":"11648918869"},{"paintseed":"203","item":"4914718000"},{"paintseed":"203","item":"12878390964"},{"paintseed":"203","item":"8200300438"},{"paintseed":"203","item":"8560970744"},{"paintseed":"600","item":"12857087733"},{"paintseed":"600","item":"3109888395"},{"paintseed":"138","item":"4732829813"},{"paintseed":"138","item":"12846764895"},{"paintseed":"138","item":"12659943200"},{"paintseed":"588","item":"9521563948"},{"paintseed":"588","item":"7599590591"},{"paintseed":"447","item":"12418972148"},{"paintseed":"447","item":"11149002991"},{"paintseed":"447","item":"12914741458"},{"paintseed":"447","item":"6601537473"},{"paintseed":"447","item":"10709318178"},{"paintseed":"20","item":"8615382939"},{"paintseed":"20","item":"3113656937"},{"paintseed":"20","item":"11098803801"},{"paintseed":"373","item":"12927689049"},{"paintseed":"373","item":"5906106435"},{"paintseed":"373","item":"10721452594"},{"paintseed":"373","item":"10480635837"},{"paintseed":"373","item":"5171686239"},{"paintseed":"256","item":"9440546409"},{"paintseed":"256","item":"12760390644"},{"paintseed":"256","item":"8948898896"},{"paintseed":"256","item":"10861467873"},{"paintseed":"256","item":"3080052578"},{"paintseed":"256","item":"10993644956"},{"paintseed":"541","item":"12863730964"},{"paintseed":"541","item":"5010083964"},{"paintseed":"541","item":"12926824122"},{"paintseed":"541","item":"11745987771"},{"paintseed":"541","item":"7153427084"},{"paintseed":"541","item":"7458970576"},{"paintseed":"465","item":"11860990227"},{"paintseed":"465","item":"4501591840"},{"paintseed":"583","item":"6940128132"},{"paintseed":"583","item":"10327393381"},{"paintseed":"583","item":"9699150998"},{"paintseed":"898","item":"12826024091"},{"paintseed":"898","item":"7822848655"},{"paintseed":"898","item":"7402877993"},{"paintseed":"966","item":"12880680658"},{"paintseed":"966","item":"8592214982"},{"paintseed":"966","item":"9917790591"},{"paintseed":"966","item":"11634899176"},{"paintseed":"442","item":"12515261089"},{"paintseed":"442","item":"12889093097"},{"paintseed":"442","item":"7026262356"},{"paintseed":"442","item":"10880967267"},{"paintseed":"726","item":"5370966315"},{"paintseed":"726","item":"10984095316"},{"paintseed":"726","item":"12740533744"},{"paintseed":"726","item":"5036372499"},{"paintseed":"836","item":"7400956592"},{"paintseed":"836","item":"6379771117"},{"paintseed":"836","item":"10271795802"},{"paintseed":"836","item":"12852022062"},{"paintseed":"836","item":"12337818206"},{"paintseed":"836","item":"7481962918"},{"paintseed":"836","item":"12513958446"},{"paintseed":"836","item":"10114715619"},{"paintseed":"279","item":"2520186831"},{"paintseed":"279","item":"9837153081"},{"paintseed":"279","item":"8524854843"},{"paintseed":"279","item":"12875770253"},{"paintseed":"279","item":"12920739474"},{"paintseed":"279","item":"12418389197"},{"paintseed":"279","item":"7523117794"},{"paintseed":"279","item":"12263766437"},{"paintseed":"878","item":"5762166652"},{"paintseed":"878","item":"12776366217"},{"paintseed":"878","item":"12177295422"},{"paintseed":"525","item":"9658922280"},{"paintseed":"525","item":"10693644962"},{"paintseed":"525","item":"12711469970"},{"paintseed":"525","item":"11504668038"},{"paintseed":"525","item":"10313473317"},{"paintseed":"525","item":"12361291935"},{"paintseed":"683","item":"12636408388"},{"paintseed":"683","item":"7825759775"},{"paintseed":"683","item":"5018905389"},{"paintseed":"683","item":"12646153797"},{"paintseed":"683","item":"8843477442"},{"paintseed":"683","item":"12264612355"},{"paintseed":"683","item":"5264569258"},{"paintseed":"298","item":"12796354347"},{"paintseed":"298","item":"8654471019"},{"paintseed":"298","item":"10185961938"},{"paintseed":"298","item":"10620980672"},{"paintseed":"298","item":"11320541584"},{"paintseed":"298","item":"12404408494"},{"paintseed":"298","item":"11861415138"},{"paintseed":"298","item":"2100938096"},{"paintseed":"298","item":"9923657621"},{"paintseed":"298","item":"7892396760"},{"paintseed":"356","item":"12696571519"},{"paintseed":"356","item":"12454645339"},{"paintseed":"356","item":"12884413396"},{"paintseed":"356","item":"3651890756"},{"paintseed":"933","item":"717143840"},{"paintseed":"933","item":"4594811379"},{"paintseed":"933","item":"3036406280"},{"paintseed":"624","item":"12433220680"},{"paintseed":"624","item":"11111399493"},{"paintseed":"624","item":"11963650536"},{"paintseed":"624","item":"12659153895"},{"paintseed":"624","item":"8648854795"},{"paintseed":"624","item":"9791859629"},{"paintseed":"807","item":"12858996948"},{"paintseed":"807","item":"2704638739"},{"paintseed":"807","item":"6252014885"},{"paintseed":"295","item":"12924182816"},{"paintseed":"295","item":"8083216611"},{"paintseed":"295","item":"12414370248"},{"paintseed":"295","item":"10782886326"},{"paintseed":"295","item":"11539273481"},{"paintseed":"885","item":"7622239340"},{"paintseed":"885","item":"1119397665"},{"paintseed":"885","item":"9080864923"},{"paintseed":"885","item":"5417179001"},{"paintseed":"731","item":"11876015682"},{"paintseed":"731","item":"6108596811"},{"paintseed":"731","item":"7344201539"},{"paintseed":"731","item":"12888019505"},{"paintseed":"812","item":"11387734111"},{"paintseed":"812","item":"10792808631"},{"paintseed":"812","item":"10134363031"},{"paintseed":"956","item":"11035530862"},{"paintseed":"956","item":"7381341887"},{"paintseed":"956","item":"6897175406"},{"paintseed":"956","item":"10068474695"},{"paintseed":"956","item":"12913460370"},{"paintseed":"956","item":"4833137113"},{"paintseed":"10","item":"11401487820"},{"paintseed":"10","item":"12605171318"},{"paintseed":"10","item":"7438891702"},{"paintseed":"650","item":"12818300368"},{"paintseed":"650","item":"12366833317"},{"paintseed":"650","item":"7123769035"},{"paintseed":"650","item":"12467701092"},{"paintseed":"650","item":"12888020350"},{"paintseed":"650","item":"12654662475"},{"paintseed":"650","item":"4284949748"},{"paintseed":"114","item":"12810226971"},{"paintseed":"114","item":"12921469192"},{"paintseed":"114","item":"12303968099"},{"paintseed":"114","item":"8691168658"},{"paintseed":"198","item":"9495982207"},{"paintseed":"198","item":"9633543008"},{"paintseed":"198","item":"12482046270"},{"paintseed":"198","item":"4295809641"},{"paintseed":"402","item":"12938626329"},{"paintseed":"402","item":"11447987405"},{"paintseed":"402","item":"8642716597"},{"paintseed":"522","item":"11280456231"},{"paintseed":"522","item":"8193145939"},{"paintseed":"522","item":"11176819495"},{"paintseed":"303","item":"1357379803"},{"paintseed":"303","item":"8849277714"},{"paintseed":"303","item":"10372894158"},{"paintseed":"303","item":"12384644734"},{"paintseed":"303","item":"7237437792"},{"paintseed":"303","item":"12927593449"},{"paintseed":"303","item":"11549473384"},{"paintseed":"303","item":"4793586567"},{"paintseed":"805","item":"859292226"},{"paintseed":"805","item":"9489698492"},{"paintseed":"805","item":"7996181412"},{"paintseed":"646","item":"9655389196"},{"paintseed":"646","item":"12408458958"},{"paintseed":"646","item":"8205289079"},{"paintseed":"646","item":"6616733275"},{"paintseed":"646","item":"10253758165"},{"paintseed":"646","item":"5216852629"},{"paintseed":"646","item":"2978031575"},{"paintseed":"646","item":"11502842209"},{"paintseed":"570","item":"12219212585"},{"paintseed":"570","item":"7322070041"},{"paintseed":"570","item":"12383431557"},{"paintseed":"570","item":"9528565745"},{"paintseed":"570","item":"11421453819"},{"paintseed":"570","item":"12405454632"},{"paintseed":"570","item":"12399074549"},{"paintseed":"445","item":"7252424708"},{"paintseed":"445","item":"12484734409"},{"paintseed":"445","item":"6619759809"},{"paintseed":"445","item":"12776961962"},{"paintseed":"553","item":"11866936697"},{"paintseed":"553","item":"10652121979"},{"paintseed":"272","item":"8563548979"},{"paintseed":"272","item":"9125491783"},{"paintseed":"272","item":"6450763457"},{"paintseed":"272","item":"6578302237"},{"paintseed":"272","item":"4703480069"},{"paintseed":"272","item":"11454455882"},{"paintseed":"803","item":"12895726584"},{"paintseed":"803","item":"12578469805"},{"paintseed":"803","item":"10369642730"},{"paintseed":"803","item":"12217810139"},{"paintseed":"99","item":"5054931263"},{"paintseed":"99","item":"6630199024"},{"paintseed":"99","item":"7183463638"},{"paintseed":"99","item":"11667749015"},{"paintseed":"762","item":"12858021744"},{"paintseed":"762","item":"6552379208"},{"paintseed":"762","item":"9725681553"},{"paintseed":"762","item":"3949489388"},{"paintseed":"762","item":"6929790228"},{"paintseed":"459","item":"12796597154"},{"paintseed":"459","item":"12891989755"},{"paintseed":"459","item":"7063222873"},{"paintseed":"459","item":"7310720866"},{"paintseed":"459","item":"10843766813"},{"paintseed":"459","item":"8347436685"},{"paintseed":"818","item":"12914656294"},{"paintseed":"818","item":"4631268710"},{"paintseed":"818","item":"12102734360"},{"paintseed":"818","item":"11703687073"},{"paintseed":"818","item":"12763074530"},{"paintseed":"348","item":"11300369728"},{"paintseed":"348","item":"8774241746"},{"paintseed":"348","item":"10116392411"},{"paintseed":"348","item":"6420471581"},{"paintseed":"348","item":"7146354233"},{"paintseed":"348","item":"9888601338"},{"paintseed":"54","item":"7523117928"},{"paintseed":"754","item":"7070450887"},{"paintseed":"754","item":"12881039952"},{"paintseed":"754","item":"4966388851"},{"paintseed":"754","item":"7405088946"},{"paintseed":"754","item":"12488676925"},{"paintseed":"754","item":"10432008976"}]');
        foreach ($patterns as $pattern){
                Paintseed::create(['item_id' => $pattern->item, 'value' => $pattern->paintseed]);
        }

        return 'OK';
    }

    public function getSteam()
    {
        $tasks = Task::with('item')->where('pattern', '!=', null)->where('client', '=', 'ska4an')
            ->where('site_id', '=', '7')->get();

        $paintseeds = [];
        foreach ($tasks as $task){
            $paterns = $task->item->patterns->where('name', '=', $task->pattern)->toArray();
            foreach ($paterns as $patern){
                $paintseeds[] = $patern['value'];

            }
        }
        $steam_ids = DB::table('paintseeds')->whereIn('value',$paintseeds)->distinct()->pluck('item_id')->toArray();

        return json_encode($steam_ids);

    }
}
