<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        $patterns = json_decode('[{"name":"★ M9 Bayonet | Case Hardened","paintseed":"601","items":["12753644505","4966311131","12669916052","12162587260","12664336450","12830620128","12811758637","3575352170","12377975458","7674750559"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"417","items":["3952474634","8082007009","11798687177","6323632329","11672143438","8097161817"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"58","items":["12847305422","12630594698","12753082481","12296024153"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"403","items":["11426973713"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"523","items":["7873254736","9415805236","7742508027","12547264814","10300544217"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"150","items":["9175258644"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"349","items":["12718296268","12670400720","8524100135","2173567196","7365867854","7537013843","12381469360"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"634","items":["10206773536","12064563177","12519686832","11733889422","11533676441","1553879284"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"239","items":["12641513344","140133264","12888879096"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"897","items":["4160345292","10215664513","12883270366","12156526321","3991450997"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"503","items":["11535209252","12874249389","12894770360","2591507651"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"354","items":["8693730521","7327202539","11986913287","6313020230"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"107","items":["12645468698","11619322261","10179122714","4193405171","4336747479"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"449","items":["2364956252","12508264502","9194735521"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"585","items":["5406324255","12234235701","12750901801","85105853","7352065466","10495217955"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"281","items":["10041436979","7238998645","9431001607","9613948514","2495441996","6422985113"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"224","items":["3998091677","11938782404","12757655302","11862278342"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"946","items":["1663053805","11425948569","11209244969","4656239357","9106087695"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"517","items":["12878542621","203041366","12711222634","11600645740","12332904490","10983846096"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"253","items":["9176600155","10470684501","11508124037"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"793","items":["5444712162","5775776714","12793456992","11534675012","12789668934"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"715","items":["9097898415","12875672174","12162147557","5657703525","2735125425","11898783128","3303285660"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"210","items":["12126209419","12776366276","6861616533"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"867","items":["12231326453","3158750535","10552919801","6196971537","2787376981"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"837","items":["12404408294","8393259572","11633501836"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"406","items":["12366170916","12892813459","9795343559"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"167","items":["9496438174","3639136253","11399613299","10536079751","8550077277"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"88","items":["7080160799","5407211864","9655355507"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"355","items":["12235822018","12345410616","1162501133","9801586423","12464805128"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"959","items":["7828629080","12877920163","11004428475","4060834701","12405436088"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"336","items":["9113678654","12564689462","10248250816","10671064952","12838726463","11808799296"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"632","items":["7573166598","1561470845"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"372","items":["12700483327","12237903367","12893440985"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"610","items":["11051366871","5686636836","12254163790","886682145"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"989","items":["6638986048","6054586955","4989689822","10801514434","9675657670","10945564729"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"59","items":["7068836308","935668292","9160477351","12470059824","8853260443","5419242380"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"41","items":["2647949617","12833039535","12863806230","3162445579","4703553179","12296657065"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"915","items":["12759059366","2766171391","6570529987"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"619","items":["12883768096","8964352621","4171680854","9916818868","12394209075","9718787413","12646487393"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"904","items":["4797395385","12715653934","5154502336","2316733235"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"811","items":["12873340054","5945257366","6259526470","12764038717","9898752843"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"166","items":["11109106931","7004054977","12479241746","12552286229","5541533232"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"628","items":["12392998430","7333564634","11583427938","9369691998","3561490468","10668329206","9617958281"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"968","items":["12026044721","10872992773","10764813339","12800605988","5489756471"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"698","items":["5460166806","2896731623","6949969930","2705315773","9986324500"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"550","items":["7375474512","10365323582","5443265588","10644651949","12479148574","7298450541","12421113881"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"202","items":["11360181254","11901357197","6323513497","11665751210"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"651","items":["12603485363","5410432979","5535040667","12074796961","10228931005"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"916","items":["12696788685","4792289771","12845977490"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"910","items":["7787011141","12649007517","6298022738","12080017292","10398974214"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"366","items":["12360305688","3382554355","12824822830","5439447625","7370493591"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"808","items":["11316981266","12873833128","12185585430","12028435646"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"177","items":["11353115366","9380496438","6824946015","11227509332"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"871","items":["3333563832","5298094059","8166570707","2795722131","12756374325","12865732914","12484265256","12810907913"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"288","items":["12555474323","10251778167","11040501369","10014575101"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"476","items":["1652971389","11477648812","9104374434","4323058749"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"292","items":["5371752214","11543504383","12189468046","11132811328","7389210326","9217099215","4557893070"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"401","items":["12623021899","12875637922","10057506812"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"179","items":["12810674169","12081289821","9704038616"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"269","items":["10261043476","6249274609","10428040047","11704870958","9105250249"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"351","items":["7314859809","10654671775","12404073010","12856907209","10832935423","10282059072"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"430","items":["11824479772","12080017350","5369264823","12271561097","9925824380","10646438821","8956958476"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"229","items":["9550741598","4977850991","8932999161"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"533","items":["9868622115","12870163143","11827620003","7741547451"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"353","items":["11320585875","5740122494","8297202520","12804612561","1068067246","12389217608","9190409565"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"413","items":["3111065120","11565738594","6799287861","10038674808","5890022128","12552286191","2923366275","12568633789"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"821","items":["11519704569","11964953300","10027884048"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"790","items":["7221447354","12506476050","9164609180","12873910301","6489044004"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"141","items":["2760384772","6313189643","6358407111","2228803275","12404540199","12882498606","5010701817"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"246","items":["12597243795","12420325292","7281104311","7248922169","7398334760"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"136","items":["1533856805","8932573549","12626206359","11568213713","10566290234","10017668511"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"955","items":["5107665647"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"613","items":["11733097613","5699269195","9776372163"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"556","items":["12242248530","6603953306","12744240852","5257362561"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"794","items":["4746261948","11628372310","4862887739"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"526","items":["11441894132","7434009934","9230942985","8463902857","11131374091","10114806877"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"173","items":["11033820533","12869268624","7126034025"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"108","items":["7575750575","12431214366","1352555716","9145692712","11232590788","11615887557","7168259613"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"117","items":["12715709732","9426443279","9955194086"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"674","items":["4072481395","11408037585","12080465383","5044517433"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"345","items":["12879210151","10509280868","10529061841","10514990978","12040781479","3123475938"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"573","items":["9651048959","7036553624","5970819247","5530462858","12595148377"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"859","items":["11349119223","5347569605","12696972335","12793314269","11752417671","3555253940","12431480113"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"103","items":["11840842726","12379443689","12888255868","9808983642","10805876788","12760713925"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"529","items":["12219161466","12571301471","9068422447","2675141179","12738606353"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"866","items":["12682060732","12837329269","12896753374"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"176","items":["11962663391","11084654456","9814920570"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"157","items":["3348267631","9680580524","10202931277"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"91","items":["11999096331","4136991485","9453424765"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"546","items":["4038220408","9947901090","11210650298","12472045627","5155710010","8746208284"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"518","items":["12532710379","12789153636","6489092421","9905777479","7275741841","12803138813"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"516","items":["11090247503","12274383182","12867423124"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"735","items":["2247947082","11053859548","12629061044"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"835","items":["12651498533","9960220778","8843476633","12830710684","10351074013","11601435968"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"524","items":["3403301529","12757777925","12356117788","12095301907","3439419742","12746358567"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"941","items":["12478094262","12442390521"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"286","items":["12328182006","5790180066","12867175125","12898852609"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"813","items":["12872600502","12173311077","11234797869","12731915632","12874406671","9721311630","12664585468","12321468336"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"783","items":["10981999933","3287059320"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"124","items":["1624849294","8468087431","3371305970","7554847933","12386376890"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"393","items":["12212992548","11918796216","12784246800","12025932814","10048559204"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"346","items":["12594536451","10699581593","11504729056","11977733257","10797218258"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"369","items":["2288012286","4503287465","12530519871","6772663672","6784445358","2858050927"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"759","items":["9769008446","12846395087","6564161562"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"97","items":["5466727369","5209648954","4094309281"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"475","items":["12825458905","12740154181","2557187310","8235344304","12781765027","12813356992"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"293","items":["11951984059","12842089256","7140647481","3918655040"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"507","items":["9220007690","4990064821","11908959035","12204222967","7915946466","12887961117","11456776883","8937454708","4092891512"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"400","items":["9137257230","10268146973","12366207771"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"681","items":["8558754057","4450115820","12408402335","2155799911"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"963","items":["6600997173","3851244287"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"764","items":["10125985187","11495405824","9223308718","6830140089","12859102079","5187585677","8860714411"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"869","items":["2982974210","8416479029","12684621017","11758003641","4966312833"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"251","items":["2910138292","12835507736"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"902","items":["10406446947","12329248334","6162937835","12409162990","10283601771"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"706","items":["11684441398"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"308","items":["9924705771","8864751195","11550904571","6485998336","12040795198"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"209","items":["3860531398","12616899642","6914437668","8783462255"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"4","items":["6633544182","12165968492","8043914417","11413738510"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"887","items":["7281375825","12718522391","7371632933","9267982215","7803058954","12086302938","5332146151"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"342","items":["12663258184","12685265060","3287054869","11390310128"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"296","items":["4922581842","5060005427"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"225","items":["4138820447","12013903905","9178320100"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"845","items":["11536314749","7176246567","11413811168","12611244157","12537577878","9585860604"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"262","items":["10856520866","12838733986","12598736248"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"170","items":["9542268475","4498136806","9891478913"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"315","items":["6529261917","751015909","12738393276"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"319","items":["9036287481","3615301669","12557265054","10014817011"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"779","items":["6999465723","12542250035","12673636109","9924478591"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"162","items":["9337068617","12894995085","12801997043","12334544224","6181506424"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"954","items":["12753994142","12426925135","6767078890","6042946343"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"608","items":["9604939902","2921367549","12283057200","9595775185","9210126927"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"409","items":["3720508050","10954595975","8950229451","6876512394","7418647943","12557358250","11317152484"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"63","items":["10919794126","12895264863","12889734924","12414785898"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"163","items":["6087583625","11993516367","6538803429"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"493","items":["10510218691"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"67","items":["11181829948","8605864984"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"204","items":["4896772261","11338459542","12858596941","3533249438","3256823063"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"569","items":["4691071615"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"598","items":["10172306959","12875325036"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"496","items":["12695391620","2930692302","10967979099","9039245767","8297101974"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"169","items":["7400483870","12744261312","12621556477","11401804770"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"580","items":["8192401470","12857547482","6756236532","9182299116"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"250","items":["7457736955","11884514657"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"668","items":["10472037446","12357019585","10132239834","4635219067","11186984197","12753350909"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"31","items":["11769504164","8647747405","8084251521"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"537","items":["12334641131","12808896668","12577128745","12701110846","12855389467"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"197","items":["12495637156","4034153648","8183384080"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"21","items":["11722129628","7367886992","10089351278"]},{"name":"★ M9 Bayonet | Case Hardened","paintseed":"203","items":["10579749599","11648918869","4914718000","12878390964","8200300438","8560970744"]}]');
//        dd($patterns);
        foreach ($patterns as $pattern){
            foreach ($pattern->items as $item){
                Paintseed::create(['item_id' => $item, 'value' => $pattern->paintseed]);
            }
        }

        return 'OK';
    }
}
