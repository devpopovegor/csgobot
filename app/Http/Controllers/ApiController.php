<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        $patterns = json_decode('[{"name":"★ Karambit | Case Hardened","paintseed":"387","items":["6413950068","12124075352","8984404232","12700753821","8777387549","12773348707","3314060447"]},{"name":"★ Karambit | Case Hardened","paintseed":"853","items":["12819629378","12859696220","11576198014","6012502454","12516255309","8455304593","12883271194"]},{"name":"★ Karambit | Case Hardened","paintseed":"442","items":["10868724234","9487171686","10179759003"]},{"name":"★ Karambit | Case Hardened","paintseed":"269","items":["7295084706","3340346419","10016521921","12639220821","12522102717","2336992053","12897105001","12263799139","12883062125"]},{"name":"★ Karambit | Case Hardened","paintseed":"470","items":["6071300602","10660660611","12894565633","3373902699","12846458599","12790739724"]},{"name":"★ Karambit | Case Hardened","paintseed":"776","items":["5590703141","9303425254","5966532738","12817209904","12380194849","12312014280","12836805884"]},{"name":"★ Karambit | Case Hardened","paintseed":"809","items":["3536182433","12400734660","11430711863","12491890994","6394467344","11424398473"]},{"name":"★ Karambit | Case Hardened","paintseed":"73","items":["12526325374","11515051195","10943157028","12204143878"]},{"name":"★ Karambit | Case Hardened","paintseed":"888","items":["10570376180"]},{"name":"★ Karambit | Case Hardened","paintseed":"902","items":["12620366071","10665319859","12753644532"]},{"name":"★ Karambit | Case Hardened","paintseed":"905","items":["5629782432","12859238512","10985214581","11761376593","12883271202","10570376214","11976921413"]},{"name":"★ Karambit | Case Hardened","paintseed":"463","items":["7917999969","7931146737","12371502147","12303112249","12782446962","4150232132","12796470656"]},{"name":"★ Karambit | Case Hardened","paintseed":"82","items":["10946757540","7006763659","12746733983"]},{"name":"★ Karambit | Case Hardened","paintseed":"510","items":["10517164785","11902476876","12273948471","4401487955","12827050770","12826645572","9699710670","11369629576"]},{"name":"★ Karambit | Case Hardened","paintseed":"256","items":["8704699481","4746932867","4674709135","8011607572","12439307498"]},{"name":"★ Karambit | Case Hardened","paintseed":"453","items":["12531575734","9775450648"]},{"name":"★ Karambit | Case Hardened","paintseed":"321","items":["9421932597","12777488365","10718305385","12536023559"]},{"name":"★ Karambit | Case Hardened","paintseed":"727","items":["11112494624","12199774013","1453011730","12817209917","12850660716","12020220187","7302944663"]},{"name":"★ Karambit | Case Hardened","paintseed":"130","items":["11041717164","10701937911","9685375345"]},{"name":"★ Karambit | Case Hardened","paintseed":"375","items":["12338297953"]},{"name":"★ Karambit | Case Hardened","paintseed":"74","items":["8650795193","12160419438","922767050","2845956676","10860460844","12891250996"]},{"name":"★ Karambit | Case Hardened","paintseed":"868","items":["12508262754","12869822692","11473811241"]},{"name":"★ Karambit | Case Hardened","paintseed":"541","items":["12843574338"]},{"name":"★ Karambit | Case Hardened","paintseed":"914","items":["12682858937","6091052404","12474329347"]},{"name":"★ Karambit | Case Hardened","paintseed":"698","items":["12209252594","8021504649","12837177806"]},{"name":"★ Karambit | Case Hardened","paintseed":"341","items":["8497215621"]},{"name":"★ Karambit | Case Hardened","paintseed":"811","items":["12704757698","12507075493","12876404069"]},{"name":"★ Karambit | Case Hardened","paintseed":"322","items":["11623620073","3873679627","12490897685","12444916059","5878200899","3723706562"]},{"name":"★ Karambit | Case Hardened","paintseed":"273","items":["7797764515","3399368153","12456740893","10308081994","10300544187","12755500081","5777171082"]},{"name":"★ Karambit | Case Hardened","paintseed":"798","items":["12445006779","12441925067","11165176629","11234617680","12067903722","11884632982","12708304249","12508267992","8432280267","12001185258"]},{"name":"★ Karambit | Case Hardened","paintseed":"664","items":["12587348581","2857513590","11111546002","12815356221","5856843467","11051068115","9315101677","10159834206","11841402099","12847687285"]},{"name":"★ Karambit | Case Hardened","paintseed":"92","items":["6622022512","6712516352","8334805281"]},{"name":"★ Karambit | Case Hardened","paintseed":"721","items":["4172276745","1328410202","9076861157","12860147363","12489873034","12468112403","8391097664"]},{"name":"★ Karambit | Case Hardened","paintseed":"494","items":["12751281769","11373163188","9976428613"]},{"name":"★ Karambit | Case Hardened","paintseed":"713","items":["6570470608","12565809765","12255085730"]},{"name":"★ Karambit | Case Hardened","paintseed":"57","items":["4577456310","11211810743"]},{"name":"★ Karambit | Case Hardened","paintseed":"25","items":["12003268852","12718536941","10695824237","9177011086","6596858856","12125691338"]},{"name":"★ Karambit | Case Hardened","paintseed":"580","items":["12793341861","3078295505","7185124427"]},{"name":"★ Karambit | Case Hardened","paintseed":"34","items":["12892657046"]},{"name":"★ Karambit | Case Hardened","paintseed":"770","items":["11001314588","11098804113","11672806857","4641075793"]},{"name":"★ Karambit | Case Hardened","paintseed":"282","items":["12363546919","9581537953","12876442816","9810303818","10618070531"]},{"name":"★ Karambit | Case Hardened","paintseed":"139","items":["12444916044","12820976092","6409498716","12892820856","12673229679"]},{"name":"★ Karambit | Case Hardened","paintseed":"262","items":["11103275187","10905365020","11279753304"]},{"name":"★ Karambit | Case Hardened","paintseed":"856","items":["10772680702","7391191676","12796906360","6197286339","9685385402","11223401982","7586007142"]},{"name":"★ Karambit | Case Hardened","paintseed":"152","items":["12227651717","12659708512","10959278252","9237561726","10837817873","12728798411","5343304335","12861684293","12795676118"]},{"name":"★ Karambit | Case Hardened","paintseed":"265","items":["5708912306","10143282174","12482359830","11332783047","8573745908","12183370873","9658793281","12106442364","8618975158","7510811389"]},{"name":"★ Karambit | Case Hardened","paintseed":"323","items":["10319910480","10708917828","12513417659","4464806947","9020993719","9793415561","12406214081","8905189574"]},{"name":"★ Karambit | Case Hardened","paintseed":"891","items":["7879532466","7807603574","12519623634"]},{"name":"★ Karambit | Case Hardened","paintseed":"989","items":["12780197744","9661088212","10767708523","11314884208","9329764617","12645370392"]},{"name":"★ Karambit | Case Hardened","paintseed":"138","items":["4828540781","12740270772","12230736254"]},{"name":"★ Karambit | Case Hardened","paintseed":"841","items":["12891980460","7736583964"]},{"name":"★ Karambit | Case Hardened","paintseed":"30","items":["9480158733","5930253391","5503606193","10692274923","8401303348","1786638132","6951028738"]},{"name":"★ Karambit | Case Hardened","paintseed":"20","items":["10061911665","12116902697","4608393683","12362703264","11477648827"]},{"name":"★ Karambit | Case Hardened","paintseed":"4","items":["12843552644","10605273881","11720273261","1991746214","353103853"]},{"name":"★ Karambit | Case Hardened","paintseed":"955","items":["12704231657","11798050671","6857303190","11063709602","3417538679"]},{"name":"★ Karambit | Case Hardened","paintseed":"823","items":["7044092489","9760441180","5730459027","4217508853"]},{"name":"★ Karambit | Case Hardened","paintseed":"330","items":["12389200964","12532967736","11212743262","12828619137","12477327334","11768508286","12220598279"]},{"name":"★ Karambit | Case Hardened","paintseed":"965","items":["9012577240","12158955472","11953217975","7415426361","12811334269","10478954759","10009489559"]},{"name":"★ Karambit | Case Hardened","paintseed":"182","items":["6998923957","10470960587","6150954891","12885435719"]},{"name":"★ Karambit | Case Hardened","paintseed":"838","items":["12449323566","6990890018","9829819792"]},{"name":"★ Karambit | Case Hardened","paintseed":"11","items":["11770375036","2770809470","4798875968","12720054179","10736227450"]},{"name":"★ Karambit | Case Hardened","paintseed":"631","items":["3247518795","12883227164","12546611858","7750975409","12486247900"]},{"name":"★ Karambit | Case Hardened","paintseed":"917","items":["10630097819","9034053997","11693282501","11502896461","12874160200","12828520191","12790860863"]},{"name":"★ Karambit | Case Hardened","paintseed":"575","items":["10700528849","11743581647","12895917955","359754783","12863807103"]},{"name":"★ Karambit | Case Hardened","paintseed":"661","items":["5991748641","5532267860","9696266006","3801172219","12487679251","2900818991"]},{"name":"★ Karambit | Case Hardened","paintseed":"670","items":["10035349102","12756239974","6685491365","12362703225","10846785328","6942117516"]},{"name":"★ Karambit | Case Hardened","paintseed":"852","items":["12547144103","3466361908","7935601613","7424050037","12868349409","6492410625","12424016742","10787846193","12638996190","12478983470"]},{"name":"★ Karambit | Case Hardened","paintseed":"112","items":["10190432687","12170242026","5718762143","9393008354"]},{"name":"★ Karambit | Case Hardened","paintseed":"509","items":["10318767305","5969574027","6298707535","12584221424","6845152776","11797216234","12656909921"]},{"name":"★ Karambit | Case Hardened","paintseed":"426","items":["12698813421","12832753491","8851052933"]},{"name":"★ Karambit | Case Hardened","paintseed":"782","items":["320558717","12397777612","12393515225","12295272624","11606313659","7528748205"]},{"name":"★ Karambit | Case Hardened","paintseed":"711","items":["11905841818","1700672484","2701671270","11047744346","12585370564","12541057198","12133036523","7889604645","11974119146"]},{"name":"★ Karambit | Case Hardened","paintseed":"655","items":["10482657498","3831988367","12484221853","10527755783","11858004966","5384731655","12245147807"]},{"name":"★ Karambit | Case Hardened","paintseed":"515","items":["10436398247","725196414","11342655764","10771615635"]},{"name":"★ Karambit | Case Hardened","paintseed":"828","items":["12823364090","7405224999","7186671240","9817705606","5590951437","11923608314","4173497648"]},{"name":"★ Karambit | Case Hardened","paintseed":"643","items":["10233810451","9156938407","12892367530","12547712149","6074086754","12323745855","12229086442"]},{"name":"★ Karambit | Case Hardened","paintseed":"310","items":["12847611239","12797221187","12821018341"]},{"name":"★ Karambit | Case Hardened","paintseed":"38","items":["8068988809","8932282546","12447852775","5137306416"]},{"name":"★ Karambit | Case Hardened","paintseed":"499","items":["9012577226","5953517401","9059397951","12530234379","12074922570","12870550442","12775628484","6846334406","12659969326"]},{"name":"★ Karambit | Case Hardened","paintseed":"236","items":["8694152291","11611297042","12843085566","12620004088","4694836641","12847538318","9307771363"]},{"name":"★ Karambit | Case Hardened","paintseed":"490","items":["8820733017","12506197748","4829527010","9854879865","11003950221","10187649201","11502380315","12518033479","4118845442"]},{"name":"★ Karambit | Case Hardened","paintseed":"844","items":["9635720853","3861083613"]},{"name":"★ Karambit | Case Hardened","paintseed":"413","items":["12535658413","1122979503","12679153332","4960821354","11985778317","7894450623"]},{"name":"★ Karambit | Case Hardened","paintseed":"595","items":["12466459918","12432388878","10833597990","12685134000","4335159287","10953590926","9531831132"]},{"name":"★ Karambit | Case Hardened","paintseed":"106","items":["6607448747","11926946154","11390244822","10765123567"]},{"name":"★ Karambit | Case Hardened","paintseed":"919","items":["1222567804","9452289601"]},{"name":"★ Karambit | Case Hardened","paintseed":"303","items":["7777045635","9424986413","11173566066","6311105103","12839780768"]},{"name":"★ Karambit | Case Hardened","paintseed":"450","items":["12730511960","2398859667","10406029077","5628265616","11389646836"]},{"name":"★ Karambit | Case Hardened","paintseed":"335","items":["6071028699","9719154259","12522528053","11975306223"]},{"name":"★ Karambit | Case Hardened","paintseed":"306","items":["7990436275","11882885413","8299984815","12768583246","11971962084"]},{"name":"★ Karambit | Case Hardened","paintseed":"488","items":["11767047817","11576113896","8807947282","8329092109","5325281811","7468280096","11843889638"]},{"name":"★ Karambit | Case Hardened","paintseed":"694","items":["12240055837","12395296769","12700289096","8752877400"]},{"name":"★ Karambit | Case Hardened","paintseed":"216","items":["10135407535","6202735311","5643268500","12186773477","12307237534"]},{"name":"★ Karambit | Case Hardened","paintseed":"796","items":["7309728043","12736391679","9046658476","5123213997"]},{"name":"★ Karambit | Case Hardened","paintseed":"405","items":["865496825","12545082463"]},{"name":"★ Karambit | Case Hardened","paintseed":"942","items":["3708304586","5127715254","12600931376","9980151416","11289383716","9905733652","9046690296"]},{"name":"★ Karambit | Case Hardened","paintseed":"109","items":["12137386114","10381170102"]},{"name":"★ Karambit | Case Hardened","paintseed":"916","items":["12806997936","12412747252","3853740717","12882464702","4596662132","11671911091","9942210490"]},{"name":"★ Karambit | Case Hardened","paintseed":"522","items":["12860296121","12483837871","9725262477","12781352489"]},{"name":"★ Karambit | Case Hardened","paintseed":"154","items":["10415871722","10270455150","12753192143"]},{"name":"★ Karambit | Case Hardened","paintseed":"371","items":["9548714966","5797163630","8959330077"]},{"name":"★ Karambit | Case Hardened","paintseed":"638","items":["9699151240","12469594662","10738813984","12445592613","5252943495"]},{"name":"★ Karambit | Case Hardened","paintseed":"615","items":["12754737338","8047464186","3630151274"]},{"name":"★ Karambit | Case Hardened","paintseed":"398","items":["10450395079","9506164703","96257637","12637988194","11140748819","10390643631"]},{"name":"★ Karambit | Case Hardened","paintseed":"803","items":["12119309703","6194593198","12729649460","12830697495"]},{"name":"★ Karambit | Case Hardened","paintseed":"637","items":["12230387185","12373122023","12172059459","10951712251","12836529456"]},{"name":"★ Karambit | Case Hardened","paintseed":"766","items":["7835251183","12523151604","9667388825","4645232682","2557316400","12684088801"]},{"name":"★ Karambit | Case Hardened","paintseed":"728","items":["12824814621","9641615158","10320402058"]},{"name":"★ Karambit | Case Hardened","paintseed":"194","items":["11576010868","4125221855","3688749113","12733980841","9874147663"]},{"name":"★ Karambit | Case Hardened","paintseed":"429","items":["10011587792","12884113055","8467056339","892946209","7159672083","2072634328"]},{"name":"★ Karambit | Case Hardened","paintseed":"284","items":["9796886297","12643930844","11725374747","8681228843"]},{"name":"★ Karambit | Case Hardened","paintseed":"177","items":["7224416554","7541895604","11521799463","9912540163","12739069880"]},{"name":"★ Karambit | Case Hardened","paintseed":"945","items":["11274112439","2045756922","8038796271","12820279143","6408513441","10154178985"]},{"name":"★ Karambit | Case Hardened","paintseed":"860","items":["12453851273","11849606641","7744612734","10296532180","5081931853","10019972537","11121843334","6245888923"]},{"name":"★ Karambit | Case Hardened","paintseed":"334","items":["9699151872","7843134113","12558348480","12843167672","2829832833","2463623244","10193286255"]},{"name":"★ Karambit | Case Hardened","paintseed":"246","items":["9679913653","9409719736","11928137198","9246866799","7031061456","12372664542"]},{"name":"★ Karambit | Case Hardened","paintseed":"985","items":["10401537299","12742984433","4174095495","8974595579","8603791619"]},{"name":"★ Karambit | Case Hardened","paintseed":"42","items":["3293840271","9526163862","12536531261","9182769010","7968723853","8703535591"]},{"name":"★ Karambit | Case Hardened","paintseed":"244","items":["11738496027","12031567083","6590307322","11644823165"]},{"name":"★ Karambit | Case Hardened","paintseed":"935","items":["9182427474","10479581978","10013582725","12409862316","5396967208","7028921858","5530120600"]},{"name":"★ Karambit | Case Hardened","paintseed":"974","items":["2658520687","6555601799","9641206749","6094907205","7046903583","12659445262"]},{"name":"★ Karambit | Case Hardened","paintseed":"179","items":["10593614793","12855024289","8429044253","12867097331","12761942389"]},{"name":"★ Karambit | Case Hardened","paintseed":"598","items":["9085305320","11838626401","5548906343","8935487487","9760044710"]},{"name":"★ Karambit | Case Hardened","paintseed":"676","items":["7442888246","11502895981","4938106239","12046952002","6170165882","10567733804","10147142345","11806414089","9285274127","4792957201","6172608061","11519574750"]},{"name":"★ Karambit | Case Hardened","paintseed":"644","items":["7958745923","8125820784","12425448410"]},{"name":"★ Karambit | Case Hardened","paintseed":"122","items":["12806227176","7247066058","8709015448","8384829599","12670965060"]},{"name":"★ Karambit | Case Hardened","paintseed":"563","items":["9490333582","12731150176","9075663338","12884788109","12148183255","12362703197"]},{"name":"★ Karambit | Case Hardened","paintseed":"128","items":["10555601208","12210611337","12239601806","10654680107","12269113548","11724280454"]},{"name":"★ Karambit | Case Hardened","paintseed":"571","items":["9804828882","10110532099","2381646475","9900269237","1285665146","5383341253"]},{"name":"★ Karambit | Case Hardened","paintseed":"767","items":["2868932073","12571314994","5683280270"]},{"name":"★ Karambit | Case Hardened","paintseed":"953","items":["12244192314","11453524082","8755831289","10032273724","5163686035"]},{"name":"★ Karambit | Case Hardened","paintseed":"547","items":["9865232935","9267941074","6786627306","12222552071","12155292035"]},{"name":"★ Karambit | Case Hardened","paintseed":"961","items":["5264416271","4675685752"]},{"name":"★ Karambit | Case Hardened","paintseed":"849","items":["7347343444","4601523708"]},{"name":"★ Karambit | Case Hardened","paintseed":"259","items":["11135736632","10379882528","6729739557"]},{"name":"★ Karambit | Case Hardened","paintseed":"875","items":["12424256141","10262980140","9467538238","8962052379","7568525093","9858305157","12341009736"]},{"name":"★ Karambit | Case Hardened","paintseed":"254","items":["9411385360","12636675977","12782240951"]},{"name":"★ Karambit | Case Hardened","paintseed":"129","items":["12721952361","7194716173","12288871573"]},{"name":"★ Karambit | Case Hardened","paintseed":"800","items":["12179095720"]},{"name":"★ Karambit | Case Hardened","paintseed":"432","items":["5846687077","11037266345","11821308730"]},{"name":"★ Karambit | Case Hardened","paintseed":"424","items":["11140198525","11140922896","5707550418","11255631342","6102155971","10055925379","10013650377","12617661850","12778090083"]},{"name":"★ Karambit | Case Hardened","paintseed":"146","items":["8355834643","3961210241","12482619179","4950299486"]},{"name":"★ Karambit | Case Hardened","paintseed":"9","items":["7242216928","12789675821","12259326420","12664611174","10020772131"]},{"name":"★ Karambit | Case Hardened","paintseed":"116","items":["12069684425","6907013130","11129007367"]},{"name":"★ Karambit | Case Hardened","paintseed":"202","items":["12836395904","10304485331","10798069905"]},{"name":"★ Karambit | Case Hardened","paintseed":"555","items":["6555450570","8106217931","7583368550","9167592063"]},{"name":"★ Karambit | Case Hardened","paintseed":"464","items":["8330305777","7334163646","12538384978","11521809280","11919756282"]},{"name":"★ Karambit | Case Hardened","paintseed":"283","items":["12884750091","11765643369","10924713924","12369331731","7723168747","4878696004"]},{"name":"★ Karambit | Case Hardened","paintseed":"381","items":["7872886889","8186256457","12795480617","9302780023","11179836665","12752769950","5210911055","11767156702","10373348692"]},{"name":"★ Karambit | Case Hardened","paintseed":"407","items":["12019006515","12394912691","11663040169","11445741028","12768055364","12895913186","3803709689","12754985610"]}]');
//        dd($patterns);
        foreach ($patterns as $pattern){
            foreach ($pattern->items as $item){
                Paintseed::create(['item_id' => $item, 'value' => $pattern->paintseed]);
            }
        }

        return 'OK';
    }
}
