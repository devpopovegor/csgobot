<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        $patterns = json_decode('[{"name":"★ Bayonet | Case Hardened","paintseed":"555","items":["6315121215","4546274431","12508982617","7919671413","7411662177","10290007406","9276929720"]},{"name":"★ Bayonet | Case Hardened","paintseed":"592","items":["12321354022","12206687672","12624375537","2733336506"]},{"name":"★ Bayonet | Case Hardened","paintseed":"670","items":["5358197113","11884841840","11551500881","7565605092","12880782145","10737136343"]},{"name":"★ Bayonet | Case Hardened","paintseed":"661","items":["12106674436","12272265439","8633961966"]},{"name":"★ Bayonet | Case Hardened","paintseed":"955","items":["6789325641","9942676452"]},{"name":"★ Bayonet | Case Hardened","paintseed":"179","items":["11265153890","11091454825"]},{"name":"★ Bayonet | Case Hardened","paintseed":"151","items":["11461208002","12508263073","9358392086"]},{"name":"★ Bayonet | Case Hardened","paintseed":"321","items":["7527334185","3661411383","8909832407","6685549349","10106303861"]},{"name":"★ Bayonet | Case Hardened","paintseed":"228","items":["8549608212","4498551379","12047284176","12640676727"]},{"name":"★ Bayonet | Case Hardened","paintseed":"695","items":["6033304833","9033720819","10036392067","12507811974","10170247966","12286886804","10425987108","12804817123","7082642012","10768674957","5927445715","11609323133"]},{"name":"★ Bayonet | Case Hardened","paintseed":"760","items":["10238055222","12855385258","12306669135","12012158081","10361454886","11832963821"]},{"name":"★ Bayonet | Case Hardened","paintseed":"828","items":["12823364820","8841831966","12883270377"]},{"name":"★ Bayonet | Case Hardened","paintseed":"617","items":["9229110434","6367195198","8660284562","12824725983","4703226778","12544161161"]},{"name":"★ Bayonet | Case Hardened","paintseed":"969","items":["3956112081","11176378447","7754412417"]},{"name":"★ Bayonet | Case Hardened","paintseed":"922","items":["1744189601"]},{"name":"★ Bayonet | Case Hardened","paintseed":"905","items":["12791214542","5338574533","7510200270","12172156595"]},{"name":"★ Bayonet | Case Hardened","paintseed":"791","items":["12761599460","12754953068","9548256217","4573053900"]},{"name":"★ Bayonet | Case Hardened","paintseed":"312","items":["12628524397","12055001863","6211377540","12169529527","7828629110"]},{"name":"★ Bayonet | Case Hardened","paintseed":"387","items":["11379931137","9327733193","12859878481","12468163181","11273005968"]},{"name":"★ Bayonet | Case Hardened","paintseed":"892","items":["8843065014"]},{"name":"★ Bayonet | Case Hardened","paintseed":"512","items":["11415232646","9535045999","11549146923","10107421421","11829454555","12112973636"]},{"name":"★ Bayonet | Case Hardened","paintseed":"604","items":["12558489182","11616673773","10614078151","12410093250","8236761808","9349250241","9335779056"]},{"name":"★ Bayonet | Case Hardened","paintseed":"479","items":["12713778994","4646302667","7688517018","11369725961"]},{"name":"★ Bayonet | Case Hardened","paintseed":"202","items":["12719109917","12241509015"]},{"name":"★ Bayonet | Case Hardened","paintseed":"868","items":["10534839267","2726290441","2963241969","5053433784"]},{"name":"★ Bayonet | Case Hardened","paintseed":"352","items":["2928818650","6902074940","6765804739"]},{"name":"★ Bayonet | Case Hardened","paintseed":"74","items":["9801945237","12685644585","9028382075","9966077389","5209026786","3740211537"]},{"name":"★ Bayonet | Case Hardened","paintseed":"996","items":["8959775056","11563308375","12812486295"]},{"name":"★ Bayonet | Case Hardened","paintseed":"163","items":["12825731132","7709746692","6205251583"]},{"name":"★ Bayonet | Case Hardened","paintseed":"259","items":["6981320749","9529884169","8236271773","1739578191"]},{"name":"★ Bayonet | Case Hardened","paintseed":"325","items":["8621838713","3552072340","386548891","1938888831"]},{"name":"★ Bayonet | Case Hardened","paintseed":"605","items":["12431514785","11206880161","2571000305","7876326808"]},{"name":"★ Bayonet | Case Hardened","paintseed":"844","items":["8097207052","12544074726"]},{"name":"★ Bayonet | Case Hardened","paintseed":"207","items":["6075621252","8131969518","9506582520","10804145785","12545393837"]},{"name":"★ Bayonet | Case Hardened","paintseed":"28","items":["4793128758","9724725781","12812486588","10752612627"]},{"name":"★ Bayonet | Case Hardened","paintseed":"209","items":["600122662","11419007083"]},{"name":"★ Bayonet | Case Hardened","paintseed":"520","items":["11340652622","6710240880","12721395883","12457399552"]},{"name":"★ Bayonet | Case Hardened","paintseed":"112","items":["8530471970","9553485159","10013272625","2976889077","10225964273","12673095500"]},{"name":"★ Bayonet | Case Hardened","paintseed":"103","items":["12857999478","268043394","3775823582","3030388815","11381385566"]},{"name":"★ Bayonet | Case Hardened","paintseed":"644","items":["10972109467","4113066310","8472006482","11980280000","5679326329","12824783973"]},{"name":"★ Bayonet | Case Hardened","paintseed":"381","items":["8792873814","803067561","6778941545"]},{"name":"★ Bayonet | Case Hardened","paintseed":"894","items":["10883219805","7328173412","11971961652","10134067498"]},{"name":"★ Bayonet | Case Hardened","paintseed":"888","items":["9533192103","6975568252"]},{"name":"★ Bayonet | Case Hardened","paintseed":"690","items":["8940590523","2220530394"]},{"name":"★ Bayonet | Case Hardened","paintseed":"809","items":["12719110206"]},{"name":"★ Bayonet | Case Hardened","paintseed":"713","items":["11610141026","12635217007","8964931372","295570268","10419196267","11612499603","8323365058","8897853747"]},{"name":"★ Bayonet | Case Hardened","paintseed":"887","items":["12773893090","10361086204","12838731151","12409272487","8886848144"]},{"name":"★ Bayonet | Case Hardened","paintseed":"82","items":["10298016633","11393137566","10121057595","8156941729"]},{"name":"★ Bayonet | Case Hardened","paintseed":"532","items":["10508579302","8944734742","11960065433","10586679631","9628975716","9279816328","12484884640"]},{"name":"★ Bayonet | Case Hardened","paintseed":"278","items":["11980076497","10404515073","9173869239","7016278707","8849525622","11843178997","11695948524","12273174476","5453526450","2362028275"]},{"name":"★ Bayonet | Case Hardened","paintseed":"750","items":["12866646541","7317892008"]},{"name":"★ Bayonet | Case Hardened","paintseed":"93","items":["10191721871","2034439207"]},{"name":"★ Bayonet | Case Hardened","paintseed":"147","items":["5664577724","12511436248","1266964386","9256411912"]},{"name":"★ Bayonet | Case Hardened","paintseed":"526","items":["1955676578","10057252199","9484847964","1773443254","4220171552"]},{"name":"★ Bayonet | Case Hardened","paintseed":"375","items":["2451993388","10105718293"]},{"name":"★ Bayonet | Case Hardened","paintseed":"430","items":["11677362909","11303962908","6908910762"]},{"name":"★ Bayonet | Case Hardened","paintseed":"189","items":["11710559857","4754194500","8848914776","10054294598","8334959294","8835843934","9915748103"]},{"name":"★ Bayonet | Case Hardened","paintseed":"122","items":["12203026523","12438274735"]},{"name":"★ Bayonet | Case Hardened","paintseed":"847","items":["6072625307","7008155794","6789522339"]},{"name":"★ Bayonet | Case Hardened","paintseed":"627","items":["5742605045","11210615854","12843552042","6770975405","8258152083","4215698423","12354351060"]},{"name":"★ Bayonet | Case Hardened","paintseed":"872","items":["6016054246","12625295662","3518087359","10504596975","12803786227","8512896384"]},{"name":"★ Bayonet | Case Hardened","paintseed":"363","items":["9965122435","12252012531","11653715047","10892921788","11768507934","5063561484"]},{"name":"★ Bayonet | Case Hardened","paintseed":"9","items":["12715720519","7827641999","12572982448"]},{"name":"★ Bayonet | Case Hardened","paintseed":"647","items":["2199912007","2308845547","10439470098","5961404622"]},{"name":"★ Bayonet | Case Hardened","paintseed":"980","items":["11366967304","10513936019","11314322352","3902659050","9991391457","12288871605"]},{"name":"★ Bayonet | Case Hardened","paintseed":"227","items":["10508751309","12707089506","11710559964","9075930849","12765949354","12586856366","12108476460"]},{"name":"★ Bayonet | Case Hardened","paintseed":"823","items":["9224954633","9980696838","8843331213","4771656635"]},{"name":"★ Bayonet | Case Hardened","paintseed":"493","items":["6283644119","4420418031"]},{"name":"★ Bayonet | Case Hardened","paintseed":"754","items":["3883604111","12769550599"]},{"name":"★ Bayonet | Case Hardened","paintseed":"235","items":["6600879253","8850025958","4742612572","10100247683"]},{"name":"★ Bayonet | Case Hardened","paintseed":"463","items":["10658855671","4147161178","9239602595","11130852080"]},{"name":"★ Bayonet | Case Hardened","paintseed":"481","items":["12845861391","12388757263","11968896257","12114700066","4656569007","4062436150"]},{"name":"★ Bayonet | Case Hardened","paintseed":"236","items":["5242026240","2223835477","5903409817","4924189997","10183307606","12888003997","10661676010"]},{"name":"★ Bayonet | Case Hardened","paintseed":"456","items":["11542851061","3196386211","2635363209","12411753581"]},{"name":"★ Bayonet | Case Hardened","paintseed":"525","items":["12771701520","9951540352","8836119286","7478551770","6835583563"]},{"name":"★ Bayonet | Case Hardened","paintseed":"878","items":["10417051356","12771153945","12238209724","3146655787","11076212506"]},{"name":"★ Bayonet | Case Hardened","paintseed":"849","items":["3538267859","9017122967","12599017154"]},{"name":"★ Bayonet | Case Hardened","paintseed":"137","items":["7881929077","11773416432","12695687888","12663179651","9499284864","11679891090","11317524515","12400510875"]},{"name":"★ Bayonet | Case Hardened","paintseed":"284","items":["5368522111","12512985608","12740623385","11464298553","8306997969"]},{"name":"★ Bayonet | Case Hardened","paintseed":"48","items":["12763010713","11710560425"]},{"name":"★ Bayonet | Case Hardened","paintseed":"385","items":["12843411390","10327415467","10324464564"]},{"name":"★ Bayonet | Case Hardened","paintseed":"240","items":["7421400897","12771037227","12533329550"]},{"name":"★ Bayonet | Case Hardened","paintseed":"921","items":["4213221338","11224012757","2663840104","8796531121"]},{"name":"★ Bayonet | Case Hardened","paintseed":"396","items":["2796473843","12470558234","8225806299","2604596514","12838333094","8714961165","5606018050"]},{"name":"★ Bayonet | Case Hardened","paintseed":"537","items":["11507907576","8779519580","12376902721","9201135071","5712112074","11462161497","11624427364"]},{"name":"★ Bayonet | Case Hardened","paintseed":"65","items":["5000778595","10340154674","10961477036","7294569330","10175824661"]},{"name":"★ Bayonet | Case Hardened","paintseed":"429","items":["7115448955","12401593216","12045000377"]},{"name":"★ Bayonet | Case Hardened","paintseed":"689","items":["10242442275","7143772680","7223383105","12563619682","11493653471","7011174335","7267428313","12497425057","8105511085"]},{"name":"★ Bayonet | Case Hardened","paintseed":"310","items":["12870521761","4806268595","5921506376"]},{"name":"★ Bayonet | Case Hardened","paintseed":"770","items":["7898676278","10943596732","9743229808","7124868140","10351994753"]},{"name":"★ Bayonet | Case Hardened","paintseed":"450","items":["12730423150","4053132502","5130386656","9638797227","10501485184","11770975532"]},{"name":"★ Bayonet | Case Hardened","paintseed":"169","items":["6309729595","8763500795","10479575246","8947132383"]},{"name":"★ Bayonet | Case Hardened","paintseed":"4","items":["9195363566","12577032788","11565381619","3248092329","12874265991"]},{"name":"★ Bayonet | Case Hardened","paintseed":"566","items":["12393673995","10143051110","9636177452","12714571340","8453102961","10206874439","3692293859"]},{"name":"★ Bayonet | Case Hardened","paintseed":"490","items":["9516644977","6777989643","4016309361","11941074895"]},{"name":"★ Bayonet | Case Hardened","paintseed":"173","items":["12729071817"]},{"name":"★ Bayonet | Case Hardened","paintseed":"970","items":["11177534448","12305607922","4282458700","11911951931","12820866754"]},{"name":"★ Bayonet | Case Hardened","paintseed":"200","items":["5694947304","2735754162","5996069590","9993551859","3061515416"]},{"name":"★ Bayonet | Case Hardened","paintseed":"467","items":["11726061041","9994224968","7913749252","12838727091"]},{"name":"★ Bayonet | Case Hardened","paintseed":"632","items":["8977177055","4892235055","12838733866"]},{"name":"★ Bayonet | Case Hardened","paintseed":"423","items":["11778681800","3936110340","8743277190"]},{"name":"★ Bayonet | Case Hardened","paintseed":"288","items":["4393202196","1012711125","3350541483"]},{"name":"★ Bayonet | Case Hardened","paintseed":"793","items":["9236803571","9446176607","12819976763","10566446491"]},{"name":"★ Bayonet | Case Hardened","paintseed":"678","items":["5297184266","7570222973","12650709232","12026833480","9499330439"]},{"name":"★ Bayonet | Case Hardened","paintseed":"360","items":["691534469","7535174829","7072275277"]},{"name":"★ Bayonet | Case Hardened","paintseed":"172","items":["9763955371","8135934548","12823772958","11357835787"]},{"name":"★ Bayonet | Case Hardened","paintseed":"81","items":["9889038347","12535932027","2962516138","5781715824","12695459350","12802523081","9030111425","5285722700","12545476174"]},{"name":"★ Bayonet | Case Hardened","paintseed":"879","items":["5287461696","11400040766","12275735406","5943402286"]},{"name":"★ Bayonet | Case Hardened","paintseed":"139","items":["10989115675","7536722944","11443118259"]},{"name":"★ Bayonet | Case Hardened","paintseed":"724","items":["6740422379","7189553627","9459818404","12323320093","8613798345","5667371285","5446933105"]},{"name":"★ Bayonet | Case Hardened","paintseed":"426","items":["12666286358","12743256252","12838729533","12557594738","12873112628","3277360722"]},{"name":"★ Bayonet | Case Hardened","paintseed":"434","items":["12290308416","12809639831","11760078020"]},{"name":"★ Bayonet | Case Hardened","paintseed":"759","items":["9679360706","12849624994","12762497811","3140993886","9876407352","12473658932"]},{"name":"★ Bayonet | Case Hardened","paintseed":"950","items":["6195311238","6562639422"]},{"name":"★ Bayonet | Case Hardened","paintseed":"610","items":["12841111357","11014821365","11071150006","4874992473","5539468532"]},{"name":"★ Bayonet | Case Hardened","paintseed":"752","items":["11120966945","3048578469","12673768719","5178391652","12753422516","11321334110","6336332572","10506998862","12535946033"]},{"name":"★ Bayonet | Case Hardened","paintseed":"843","items":["6909595364","4613927718","12886112770","7161176615","3664294101"]},{"name":"★ Bayonet | Case Hardened","paintseed":"874","items":["11792790822","8916349337","12292671519","11417515431"]},{"name":"★ Bayonet | Case Hardened","paintseed":"624","items":["6526709266","12512512504","12884659078","7235393728","8840474666"]},{"name":"★ Bayonet | Case Hardened","paintseed":"428","items":["11815179789","12522558741","12639480292"]},{"name":"★ Bayonet | Case Hardened","paintseed":"685","items":["10102258267","10219107302","12867411230","12670921337","5534159200","10158078254"]},{"name":"★ Bayonet | Case Hardened","paintseed":"862","items":["12750528339","7479316651","12510506704","9521559200","7881319973"]},{"name":"★ Bayonet | Case Hardened","paintseed":"681","items":["12721875363","12569718651","12539361634"]},{"name":"★ Bayonet | Case Hardened","paintseed":"497","items":["6236019839","10578994613","3258406284"]},{"name":"★ Bayonet | Case Hardened","paintseed":"557","items":["1670152947","12740126320"]},{"name":"★ Bayonet | Case Hardened","paintseed":"727","items":["12234397841","12771792769","10089461803","3046011338","12615210516"]},{"name":"★ Bayonet | Case Hardened","paintseed":"366","items":["11447443101","12588427390","12443176222"]},{"name":"★ Bayonet | Case Hardened","paintseed":"814","items":["12327406749","12081312512","8994445089","9212443610","9992627427"]},{"name":"★ Bayonet | Case Hardened","paintseed":"205","items":["11427283477","10591467447"]},{"name":"★ Bayonet | Case Hardened","paintseed":"149","items":["12848396381","6342377047","7669325865","12725114380","3431885492","11262942225","7724907703"]},{"name":"★ Bayonet | Case Hardened","paintseed":"575","items":["12771037319","12696596971","12654526285"]},{"name":"★ Bayonet | Case Hardened","paintseed":"628","items":["10722573919","12408201888"]},{"name":"★ Bayonet | Case Hardened","paintseed":"243","items":["11752768700","3120465856","833504654","7342633690","7011232217","8693653178"]},{"name":"★ Bayonet | Case Hardened","paintseed":"775","items":["7601778730","4917366447","10280935570"]},{"name":"★ Bayonet | Case Hardened","paintseed":"472","items":["12286654612","3455809960","12702202201","10312769399","12005555835","5327768829","12258190588"]},{"name":"★ Bayonet | Case Hardened","paintseed":"380","items":["7566554459","6076932164","11737572331","4750791515","12729702982","9979416624"]},{"name":"★ Bayonet | Case Hardened","paintseed":"485","items":["12645602927","12531898049","9102908789"]},{"name":"★ Bayonet | Case Hardened","paintseed":"578","items":["12895820506","12378147992","5402052595","3771376864","12747609584","3428262717","9471720307","8693992306","3553494239"]},{"name":"★ Bayonet | Case Hardened","paintseed":"869","items":["9507239668","5820250965","12811027413","4105021457","9526342110","10519216706","10277901137","8673154452"]},{"name":"★ Bayonet | Case Hardened","paintseed":"710","items":["10308177271","3466896069","8623553367","10061679535"]},{"name":"★ Bayonet | Case Hardened","paintseed":"935","items":["11424529425","2426035514","12850254020","12884483621"]},{"name":"★ Bayonet | Case Hardened","paintseed":"349","items":["12400245638","9761793753","1848289600","11549742642","12063468393"]},{"name":"★ Bayonet | Case Hardened","paintseed":"951","items":["12763200126","12838732170"]},{"name":"★ Bayonet | Case Hardened","paintseed":"669","items":["12771977033","11734841930","4148738756","12892981029","6314267283","6101934733","9493016089","6699253036"]},{"name":"★ Bayonet | Case Hardened","paintseed":"286","items":["8863723703","10396266935","11570955097"]},{"name":"★ Bayonet | Case Hardened","paintseed":"11","items":["7722433642","12885733922","12328182163","4922215993","12085253666"]},{"name":"★ Bayonet | Case Hardened","paintseed":"101","items":["3854078766","3027350681","8693972252"]},{"name":"★ Bayonet | Case Hardened","paintseed":"226","items":["1574157742"]},{"name":"★ Bayonet | Case Hardened","paintseed":"468","items":["5377783347","8549390529","12723418592"]},{"name":"★ Bayonet | Case Hardened","paintseed":"797","items":["12672808526","12756256452","12142548682","12716935467","5830585987","6713874002","2420311649","11857459627"]}]');
//        dd($patterns);
        foreach ($patterns as $pattern){
            foreach ($pattern->items as $item){
                Paintseed::create(['item_id' => $item, 'value' => $pattern->paintseed]);
            }
        }

        return 'OK';
    }
}
