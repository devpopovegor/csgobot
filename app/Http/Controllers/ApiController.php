<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        $patterns = json_decode('[{"name":"★ Karambit | Fade","paintseed":"412","items":["9949959088","11990557381","4587503902","7816523221","2590242169"]},{"name":"★ Karambit | Fade","paintseed":"393","items":["3531429254","11945532539","288976991","12447790094","1083593278","8316384525"]},{"name":"★ Karambit | Fade","paintseed":"602","items":["12497135244","7100748996","8857269128","9186459906","5582815547","12050338352"]},{"name":"★ Karambit | Fade","paintseed":"359","items":["12340586242","11489253667","11610557590","6347723261","11140871616","10936487111","8670729582"]},{"name":"★ Karambit | Fade","paintseed":"701","items":["11906773039","12163086200","8086434333","11527940518","12769986585","2823064369","11068646852","5789541897","7157969560"]},{"name":"★ Karambit | Fade","paintseed":"649","items":["12634467281","11499105380","6223180388","7447837278","12838595900"]},{"name":"★ Karambit | Fade","paintseed":"16","items":["4868104727","11977124533","9195062208","8829202717","248297902","370753234"]},{"name":"★ Karambit | Fade","paintseed":"146","items":["7560971276","11536300042","6082903518","7704747299","8240854791","4285325715"]},{"name":"★ Karambit | Fade","paintseed":"241","items":["9394256240","6648426843","12294843095"]},{"name":"★ Karambit | Fade","paintseed":"541","items":["12686586582","8583695141","9568229451"]},{"name":"★ Karambit | Fade","paintseed":"688","items":["10206850224","4300078750","1667398301","12861357309","10390112795"]},{"name":"★ Karambit | Fade","paintseed":"673","items":["1567049085","10781403253","6941773683"]},{"name":"★ Karambit | Fade","paintseed":"281","items":["8438913566","7705815173","910153304","327192258","11040624642"]},{"name":"★ Karambit | Fade","paintseed":"344","items":["12446775003","11906920569","12693298856"]},{"name":"★ Karambit | Fade","paintseed":"743","items":["12301069656","12865143591","7953538873"]},{"name":"★ Karambit | Fade","paintseed":"777","items":["12743614260","4341793794","7533696600","8960159510","3156897100","8718993079"]},{"name":"★ Karambit | Fade","paintseed":"292","items":["2433394375","4857948851","12606079049","12368798236"]},{"name":"★ Karambit | Fade","paintseed":"994","items":["12241647279","12033547304","11128702617"]},{"name":"★ Karambit | Fade","paintseed":"152","items":["11120202807","7929783902","12827050769"]},{"name":"★ Karambit | Fade","paintseed":"918","items":["5224794302","8654533581","12752000818","12884865080","152797840","11060737064"]},{"name":"★ Karambit | Fade","paintseed":"792","items":["7239759584","12258741313","1712871154","8667507062","12815271569","10938998904","6140346386","8179465815","11344247994","12847323108"]},{"name":"★ Karambit | Fade","paintseed":"628","items":["8894605567","5669063180","8166781467","5029120637","8499061134","11562026873","12663173702","11632993215","10164497188","11229440042","9109694391","7187680561"]},{"name":"★ Karambit | Fade","paintseed":"332","items":["11173996967","5827510279","10042469873","11499987622","6721874878","10912134554","12880111544"]},{"name":"★ Karambit | Fade","paintseed":"129","items":["8809292937","5179443959","12421448628","6131505545","4734046534","10313060398","12853795243","11110723314"]},{"name":"★ Karambit | Fade","paintseed":"874","items":["12581290407","9503761712","10421203351","6612220213","11393932123","12359323540","12764132371"]},{"name":"★ Karambit | Fade","paintseed":"787","items":["12877380537","12239030633","11863184971","10222095363","10973846370"]},{"name":"★ Karambit | Fade","paintseed":"126","items":["9463784332","10309858753","12060570724","12895690641","1573166221","8337723575"]},{"name":"★ Karambit | Fade","paintseed":"923","items":["12722918605","12475107296","5642772299","2701477582","7766499790","12242416087","6495555910","93329001","11051954628","9320000118"]},{"name":"★ Karambit | Fade","paintseed":"908","items":["8619010465","7982346986"]},{"name":"★ Karambit | Fade","paintseed":"780","items":["11190197299","6707118306","12895004992","12751489852"]},{"name":"★ Karambit | Fade","paintseed":"48","items":[]},{"name":"★ Karambit | Fade","paintseed":"832","items":["10687732677","11915617612","12828414807","11623933460","11385539723","4208809531","10912134405"]},{"name":"★ Karambit | Fade","paintseed":"736","items":["11910796387","6016412819"]},{"name":"★ Karambit | Fade","paintseed":"252","items":["6818353328","6027273585","11493142766","8508372259","12603247617","12440459971","9692433525"]},{"name":"★ Karambit | Fade","paintseed":"204","items":["6521086861","3792267078","9202379071"]},{"name":"★ Karambit | Fade","paintseed":"182","items":["10165666815","779235664"]},{"name":"★ Karambit | Fade","paintseed":"457","items":["811746038","11237758150","9021786861","12808451954","10916047598","12608688972","11786054439","12671102223","2963693244"]},{"name":"★ Karambit | Fade","paintseed":"685","items":["6346457549","12421927736","7088505459"]},{"name":"★ Karambit | Fade","paintseed":"660","items":["3379183783","10283368058","119470701","4932351425","12666155530","12707297551","12433285169"]},{"name":"★ Karambit | Fade","paintseed":"652","items":["5969003285","387777382","11338880553","4565040568"]},{"name":"★ Karambit | Fade","paintseed":"705","items":["6797196213","12483838507"]},{"name":"★ Karambit | Fade","paintseed":"578","items":["10257509021","11139830648","9716642819"]},{"name":"★ Karambit | Fade","paintseed":"522","items":["6191059418","5657265045","5002081677","7987818580","4260571022","9874705888","1003560011"]},{"name":"★ Karambit | Fade","paintseed":"988","items":["11642545442","4797759461","6422473689"]},{"name":"★ Karambit | Fade","paintseed":"607","items":["9927548443","9016142861"]},{"name":"★ Karambit | Fade","paintseed":"230","items":["10169526494","5003898938","7253851178","12315115878","11527820354","11843203334","12316917241"]},{"name":"★ Karambit | Fade","paintseed":"444","items":["12676524394","41056956","9007992104","8744192520"]},{"name":"★ Karambit | Fade","paintseed":"471","items":["5958382387","11892390987","1415227700","10015290719","12643626300","12803436731"]},{"name":"★ Karambit | Fade","paintseed":"773","items":["4888183993","12328900054","10863735427","12807870080","12413972919"]},{"name":"★ Karambit | Fade","paintseed":"452","items":["12223711481","6334103185","11327802028","4348015301","12235233278","11586234599","6551517101","2063354877"]},{"name":"★ Karambit | Fade","paintseed":"631","items":["6114034580","12258586360","4202266570","12213624838","9777027021","12420199674","11698663661"]},{"name":"★ Karambit | Fade","paintseed":"982","items":["10528803396","11188733676","11997340529","11715583191"]},{"name":"★ Karambit | Fade","paintseed":"356","items":["9381257088","4092653609","11948167483","6929661318"]},{"name":"★ Karambit | Fade","paintseed":"340","items":["11926036104","11654701141","10096863131","11269725677","10262985660"]},{"name":"★ Karambit | Fade","paintseed":"621","items":["12808270668","10044448869","12840796308","4740798382","10136191278"]},{"name":"★ Karambit | Fade","paintseed":"112","items":["7981488253","12318101216","12306015844","4981815245","11884645503"]},{"name":"★ Karambit | Fade","paintseed":"876","items":["11057200256","12687261824","12080649711","8775225951","12844200408","12115186427","12153771888"]},{"name":"★ Karambit | Fade","paintseed":"761","items":["1803992494","9633046763","12855609610","11013841743","10020249814"]},{"name":"★ Karambit | Fade","paintseed":"873","items":["9939397511","12782214621"]},{"name":"★ Karambit | Fade","paintseed":"614","items":["12731420605","7279461052","11177256688","10389128822","12063228463"]},{"name":"★ Karambit | Fade","paintseed":"14","items":["10381542880","6716706568","12274547361","12661374929"]},{"name":"★ Karambit | Fade","paintseed":"274","items":["9762368597","8129502704","6933521010"]},{"name":"★ Karambit | Fade","paintseed":"795","items":["6935157925","10571346330","443594533","8573501544","10954406728","10542222546","10995294945","12457830906","11918957032"]},{"name":"★ Karambit | Fade","paintseed":"653","items":["7003549070","11247269023","12605973458","12701005797","6294502017","12086110804"]},{"name":"★ Karambit | Fade","paintseed":"683","items":["6585474018","11174574404","6220046775","12024995205","7890242577","12218634768","5340970568"]},{"name":"★ Karambit | Fade","paintseed":"826","items":["7802820131","12546631870","12690758517"]},{"name":"★ Karambit | Fade","paintseed":"867","items":["8455305002","3287436064","11544451757","12419295192","10872026847","9602759678"]},{"name":"★ Karambit | Fade","paintseed":"728","items":["4927057685","10321533684","12044660767","12586912550","4868377700","1081607631","12488048045"]},{"name":"★ Karambit | Fade","paintseed":"405","items":["3397422753","12670257608","12004123092","11464865224","8228196266"]},{"name":"★ Karambit | Fade","paintseed":"454","items":["7352978199","3130903297","12838595690"]},{"name":"★ Karambit | Fade","paintseed":"108","items":["8629578066","8648371234","4840893300"]},{"name":"★ Karambit | Fade","paintseed":"732","items":["10905772820","5104553331","12885200104","12085455080","12758289725","9751122626","12831633301","12013644500"]},{"name":"★ Karambit | Fade","paintseed":"803","items":["5369556726","10467830233","2544609039","8040177938","286029648","10179573457"]},{"name":"★ Karambit | Fade","paintseed":"233","items":["11706642990","7971239171","10603206826","6047990694","12586419649","10300569534"]},{"name":"★ Karambit | Fade","paintseed":"1000","items":[]},{"name":"★ Karambit | Fade","paintseed":"770","items":["9029703730","10996120789","5179504825","12271694415"]},{"name":"★ Karambit | Fade","paintseed":"32","items":["12788484057","11670813571","12180756095","11528438599","303716597","11725686100","9623768526","3828145521","7311817228","10769434950","8606202087","2375938930"]},{"name":"★ Karambit | Fade","paintseed":"8","items":["12483838625","12520134410","12897239234"]},{"name":"★ Karambit | Fade","paintseed":"58","items":["11067990136","10749715290","12645769520","108552271","12763275737","1844570269","5331469043","12614458578","5656569518","7745843698"]},{"name":"★ Karambit | Fade","paintseed":"949","items":["12193630779","9565622955","9277857133","6560816104"]},{"name":"★ Karambit | Fade","paintseed":"243","items":["11814125073","5753610904","11797693869","9869120702","1221391767"]},{"name":"★ Karambit | Fade","paintseed":"702","items":["10363172577","7118464586","10510513196","9088568059","11932121126"]},{"name":"★ Karambit | Fade","paintseed":"213","items":["12305527491","12205859970","10626974219"]},{"name":"★ Karambit | Fade","paintseed":"202","items":["12219704424","6280789526","10731109908","10295313356","12564002891","12776823078","3951803125","9516841060"]},{"name":"★ Karambit | Fade","paintseed":"971","items":["12811435656","665019269","12336618018","10220438749","12826461056","10584045429","4774567238","5177300120","12331678751"]},{"name":"★ Karambit | Fade","paintseed":"188","items":["11541985946","12652209102","12654651088","11880169460"]},{"name":"★ Karambit | Fade","paintseed":"337","items":["12452996480","12378038925","9424374130","5402059509"]},{"name":"★ Karambit | Fade","paintseed":"378","items":["3961843036","4568493203","9733754125","12850350569","1698093475","9767613815","1544303848","12013896715","12852695801"]},{"name":"★ Karambit | Fade","paintseed":"539","items":["12648395030","11059139129","12611235483"]},{"name":"★ Karambit | Fade","paintseed":"854","items":["11032052851","12341903609","9133252241"]},{"name":"★ Karambit | Fade","paintseed":"5","items":["12770961636","2611038409","8128426534","12898109119"]},{"name":"★ Karambit | Fade","paintseed":"966","items":["11175793696","12663964838","11066299912","12432617077"]},{"name":"★ Karambit | Fade","paintseed":"178","items":["8330538063","12347997994","11759621512","8687273925","11677126855","10545032568","12592221267","10140986219"]},{"name":"★ Karambit | Fade","paintseed":"696","items":["6789299703","11108559647"]},{"name":"★ Karambit | Fade","paintseed":"406","items":["12350947522","12298243143","11504401309","10162239461","12885614811","12333840085"]},{"name":"★ Karambit | Fade","paintseed":"461","items":["8143543307","12643609572","70320331","9861410590","12579837562"]},{"name":"★ Karambit | Fade","paintseed":"922","items":["9804474840","6249384431","12029806160","26306625","10054407803","11074991686"]},{"name":"★ Karambit | Fade","paintseed":"493","items":["1395626576","11498285236","8093119156"]},{"name":"★ Karambit | Fade","paintseed":"959","items":["12382298136","2286087883","11987752225","3645920778","8270179583"]},{"name":"★ Karambit | Fade","paintseed":"997","items":["9401402016","1599657687","5035777803","10520090363","12006569782","2336185577","11179912791","2626698198","10753572473"]},{"name":"★ Karambit | Fade","paintseed":"149","items":["6974357538","9585397178","11830593662","12077172269","12533298301","3978342705","6550409505"]},{"name":"★ Karambit | Fade","paintseed":"655","items":["9758400400","12707413859","12108771276","12794987114","12870860625","7765443586","11188019954"]},{"name":"★ Karambit | Fade","paintseed":"171","items":["10850650785","8967547995","11969870786","12109797066","4426670328"]},{"name":"★ Karambit | Fade","paintseed":"637","items":["8729123789","8494208281","8963143325"]},{"name":"★ Karambit | Fade","paintseed":"68","items":["12506571451","12823996942","12494625822","12520921194"]},{"name":"★ Karambit | Fade","paintseed":"287","items":["9227614230","12848308774","10498556617","9880147342","5144534383","10378079471"]},{"name":"★ Karambit | Fade","paintseed":"656","items":["6151403397","10435546007","12015792055","9928414381","2332355676"]},{"name":"★ Karambit | Fade","paintseed":"766","items":["7044481574","10522102473","4162086337","10579113167","4342280090","11789157047"]},{"name":"★ Karambit | Fade","paintseed":"817","items":["10344137216","8868832510","7063863919","9516763890","11050391261","6372638735","9295288608"]},{"name":"★ Karambit | Fade","paintseed":"165","items":["8168038146","9247503948","12421008881","4801142858","11988210367","8382049140","12486329195"]},{"name":"★ Karambit | Fade","paintseed":"516","items":["5474461203","8613034562"]},{"name":"★ Karambit | Fade","paintseed":"370","items":["923675411","8627531610","11334067271","10121768779","5729352093"]},{"name":"★ Karambit | Fade","paintseed":"672","items":["9137309162","8248940371","4614685833"]},{"name":"★ Karambit | Fade","paintseed":"499","items":["5091788232","4272670230","10289766863","6490322459"]},{"name":"★ Karambit | Fade","paintseed":"706","items":["10203505133","9015629964","11673203341","10016686668","2820394580","12322514952","8929787130","4174794402"]},{"name":"★ Karambit | Fade","paintseed":"121","items":["3747325746","10560678668","11100410391","6272120232"]},{"name":"★ Karambit | Fade","paintseed":"238","items":["12826250715","12141833545"]},{"name":"★ Karambit | Fade","paintseed":"545","items":["10960849836","1101280798","11038513734","12119309766","12010651999"]},{"name":"★ Karambit | Fade","paintseed":"206","items":["10861198827","5980738092","2919697934","12882818599","6298966259","12770327334","12666332914","12319853570","210628740","11845382869","8122388128","12458030963"]},{"name":"★ Karambit | Fade","paintseed":"591","items":["8133890357","12859489807","12617463024","10155949447","7181460559","10911592235","8376152231"]},{"name":"★ Karambit | Fade","paintseed":"546","items":["12106961937","10109025928","10940925942"]},{"name":"★ Karambit | Fade","paintseed":"177","items":["5408215420","7053308358","12697751388","12745181283","11361064195","9608020928","8019471425"]},{"name":"★ Karambit | Fade","paintseed":"844","items":["10965969688"]},{"name":"★ Karambit | Fade","paintseed":"977","items":["10969849673","5880924216","10955310666","7224827226","10131947243","10909297965","7108019160"]},{"name":"★ Karambit | Fade","paintseed":"589","items":["6139223661","11991203557","2568828489","6884453517","11262329413","12861458360","12879735913","12856141897"]},{"name":"★ Karambit | Fade","paintseed":"764","items":["11849617636","10686269653","9207315339","1835356731","6974102583","10140886722","11255826043","10815421959"]},{"name":"★ Karambit | Fade","paintseed":"156","items":["2154316653"]},{"name":"★ Karambit | Fade","paintseed":"868","items":["3462660923","12350725888","4396054995"]},{"name":"★ Karambit | Fade","paintseed":"402","items":["10006063792","7090883386","9163821035","12706894430"]},{"name":"★ Karambit | Fade","paintseed":"725","items":["12045429669","12298490224","12563453708","2820394471"]},{"name":"★ Karambit | Fade","paintseed":"791","items":["7424019340","10165052889"]},{"name":"★ Karambit | Fade","paintseed":"858","items":["12429814615","12846916302","10101048155","2065032945","5101710878"]},{"name":"★ Karambit | Fade","paintseed":"810","items":["12447177302","12773708630","10915845374","5966284861"]},{"name":"★ Karambit | Fade","paintseed":"553","items":["2914813688","11101161022","12829488228","10775100373","12812390814","9269180447","12469660018"]},{"name":"★ Karambit | Fade","paintseed":"28","items":["3768314090","11190219762","12544739267"]},{"name":"★ Karambit | Fade","paintseed":"441","items":["11852579963","5263587801"]},{"name":"★ Karambit | Fade","paintseed":"972","items":["5921567051","1669175542","7937359258","3683243379","11670895465","9951507635","4960639784"]},{"name":"★ Karambit | Fade","paintseed":"559","items":["5639069395","7112627454","2842519265","1560288410","4515764665","12638260344","9410218631"]},{"name":"★ Karambit | Fade","paintseed":"632","items":["142249562","10618227988","12653388385","6310767812","392183075","246826869"]},{"name":"★ Karambit | Fade","paintseed":"372","items":["11197539077","741227854"]},{"name":"★ Karambit | Fade","paintseed":"329","items":["8395214736","12887482993","10989959075","5905023743","906015686","10983715513","5619317096","12817960356"]},{"name":"★ Karambit | Fade","paintseed":"753","items":["7186205757","2176870636","12743369207"]},{"name":"★ Karambit | Fade","paintseed":"756","items":["6676702053","12703451626","12670304528"]},{"name":"★ Karambit | Fade","paintseed":"232","items":["12674938112","12782747830","11152997843","11869455387"]},{"name":"★ Karambit | Fade","paintseed":"976","items":["10991020680","7231468058","12077220420","12664741212","12741754136"]},{"name":"★ Karambit | Fade","paintseed":"785","items":["5756482791","11442298424","12416834630","12450069147"]},{"name":"★ Karambit | Fade","paintseed":"727","items":["6787618957"]},{"name":"★ Karambit | Fade","paintseed":"90","items":["12659699611","12640675558"]},{"name":"★ Karambit | Fade","paintseed":"941","items":["10546911303","12675930725","12666508011","8903029501"]},{"name":"★ Karambit | Fade","paintseed":"351","items":["12297732686","11108741921","11809402864","12436880233","10144646257"]}]');
//        dd($patterns);
        foreach ($patterns as $pattern){
            foreach ($pattern->items as $item){
                Paintseed::create(['item_id' => $item, 'value' => $pattern->paintseed]);
            }
        }

        return 'OK';
    }
}
