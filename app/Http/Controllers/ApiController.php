<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Telegram\Bot\Laravel\Facades\Telegram;

class ApiController extends Controller
{
    public function addItem()
    {
        $name = $_GET['name'];
        $phase = $_GET['phase'] ? $_GET['phase'] : '';
        $float = $_GET['float'];
        $pattern = $_GET['pattern'];
        $item = Item::where('name', '=', $name)->where('phase', '=', $phase)->first();
        if ($item){
            if (Task::where('item_id', '=', $item->id)->where('client','=','ska4an')
                ->where('site_id', '=', 7)->where('float', '=', $float)->where('pattern', '=', $pattern)->first()){
                return "Search already exists";
            }
        }
        else {
            return "Item not exists";
        }

        Task::create(['item_id' => $item->id, 'site_id' => 7, 'float' => $float, 'client' => 'ska4an', 'pattern' => $pattern, 'chat_id' => '']);
        return "OK";
    }

    public function getList()
    {
        $tasks = json_encode(Task::with('item')->where('site_id', '=', '7')
            ->where('client','=', 'ska4an')->get());

        return json_encode($tasks);
    }

    public function getPatterns()
    {
        return json_encode(Pattern::all());
    }

    public function send()
    {
    	$item = Item::find($_GET['item_id']);
	    Telegram::sendMessage([
		    'chat_id' => 222881167,
		    'text' => "Бот для cs.money отправил оффер на {$item->full_name}",
		    'parse_mode' => 'HTML'
	    ]);

	    return json_encode('ok');
    }

    public function setPatterns()
    {
        set_time_limit(0);
        $patterns = json_decode('[{"paintseed":"670","item":"4394705674"},{"paintseed":"670","item":"12807565046"},{"paintseed":"670","item":"10433306859"},{"paintseed":"670","item":"8793117373"},{"paintseed":"670","item":"11072454755"},{"paintseed":"670","item":"12846918873"},{"paintseed":"321","item":"6009276232"},{"paintseed":"321","item":"12207071112"},{"paintseed":"321","item":"9570299189"},{"paintseed":"661","item":"11739071808"},{"paintseed":"661","item":"12449882094"},{"paintseed":"661","item":"12376664164"},{"paintseed":"661","item":"12740398270"},{"paintseed":"151","item":"11985852558"},{"paintseed":"151","item":"4844267735"},{"paintseed":"151","item":"12929506092"},{"paintseed":"151","item":"10650260409"},{"paintseed":"151","item":"12593306153"},{"paintseed":"151","item":"12261905435"},{"paintseed":"555","item":"12859816941"},{"paintseed":"555","item":"12074563795"},{"paintseed":"555","item":"11167216442"},{"paintseed":"555","item":"12575966485"},{"paintseed":"555","item":"12611869951"},{"paintseed":"555","item":"12900262636"},{"paintseed":"555","item":"12564586119"},{"paintseed":"592","item":"11837894717"},{"paintseed":"592","item":"7724303874"},{"paintseed":"592","item":"9804605189"},{"paintseed":"592","item":"11379845895"},{"paintseed":"592","item":"10024308103"},{"paintseed":"955","item":"10311076011"},{"paintseed":"955","item":"6604077874"},{"paintseed":"955","item":"6760067151"},{"paintseed":"179","item":"9557286670"},{"paintseed":"179","item":"5260572504"},{"paintseed":"760","item":"12840987949"},{"paintseed":"760","item":"11337912154"},{"paintseed":"760","item":"12754672948"},{"paintseed":"387","item":"10314028644"},{"paintseed":"387","item":"8060798466"},{"paintseed":"828","item":"12209693987"},{"paintseed":"828","item":"10152022483"},{"paintseed":"828","item":"8483132370"},{"paintseed":"828","item":"7399545486"},{"paintseed":"828","item":"10910758737"},{"paintseed":"828","item":"10828186966"},{"paintseed":"828","item":"12903921352"},{"paintseed":"828","item":"6997256941"},{"paintseed":"828","item":"12089419071"},{"paintseed":"828","item":"11863926435"},{"paintseed":"791","item":"12021198251"},{"paintseed":"791","item":"10597595495"},{"paintseed":"791","item":"2607073685"},{"paintseed":"791","item":"12798490595"},{"paintseed":"791","item":"6185750123"},{"paintseed":"791","item":"10633868636"},{"paintseed":"844","item":"3427887406"},{"paintseed":"844","item":"8707274354"},{"paintseed":"844","item":"12927551916"},{"paintseed":"844","item":"7293407722"},{"paintseed":"868","item":"12582645762"},{"paintseed":"868","item":"12733090619"},{"paintseed":"868","item":"218263450"},{"paintseed":"868","item":"11992479179"},{"paintseed":"823","item":"1143024607"},{"paintseed":"823","item":"5582299718"},{"paintseed":"823","item":"9837586512"},{"paintseed":"823","item":"12893224703"},{"paintseed":"823","item":"4900055622"},{"paintseed":"823","item":"8846136980"},{"paintseed":"823","item":"8354045255"},{"paintseed":"168","item":"6053957681"},{"paintseed":"479","item":"12627579126"},{"paintseed":"479","item":"5451579744"},{"paintseed":"905","item":"6618293938"},{"paintseed":"905","item":"12336916624"},{"paintseed":"905","item":"12904170251"},{"paintseed":"809","item":"10952746690"},{"paintseed":"809","item":"5653879736"},{"paintseed":"809","item":"9994247167"},{"paintseed":"809","item":"9710955464"},{"paintseed":"28","item":"10202188668"},{"paintseed":"28","item":"5444748387"},{"paintseed":"28","item":"3151571134"},{"paintseed":"28","item":"6950585488"},{"paintseed":"996","item":"12482521022"},{"paintseed":"996","item":"12348886225"},{"paintseed":"996","item":"8696005499"},{"paintseed":"617","item":"8256527376"},{"paintseed":"617","item":"3505628678"},{"paintseed":"617","item":"12871987116"},{"paintseed":"617","item":"9693919879"},{"paintseed":"617","item":"178677405"},{"paintseed":"617","item":"12712101202"},{"paintseed":"312","item":"11001180138"},{"paintseed":"312","item":"8768161079"},{"paintseed":"312","item":"6947403893"},{"paintseed":"312","item":"8169206642"},{"paintseed":"312","item":"12020320175"},{"paintseed":"312","item":"9546919888"},{"paintseed":"312","item":"8643596936"},{"paintseed":"892","item":"12802451297"},{"paintseed":"892","item":"6544961116"},{"paintseed":"892","item":"10057672264"},{"paintseed":"526","item":"11312366680"},{"paintseed":"526","item":"9621005854"},{"paintseed":"526","item":"11039607022"},{"paintseed":"526","item":"7681382315"},{"paintseed":"750","item":"4130725481"},{"paintseed":"750","item":"7321995828"},{"paintseed":"750","item":"12437275687"},{"paintseed":"750","item":"12509458239"},{"paintseed":"750","item":"12437275796"},{"paintseed":"750","item":"6846997386"},{"paintseed":"750","item":"12204781171"},{"paintseed":"189","item":"12715945304"},{"paintseed":"189","item":"12425919827"},{"paintseed":"189","item":"3230057485"},{"paintseed":"189","item":"8486348949"},{"paintseed":"189","item":"7517234704"},{"paintseed":"532","item":"11540923393"},{"paintseed":"532","item":"9508894733"},{"paintseed":"363","item":"3779122127"},{"paintseed":"363","item":"8269937008"},{"paintseed":"103","item":"3344788408"},{"paintseed":"103","item":"7591418087"},{"paintseed":"103","item":"2923462854"},{"paintseed":"103","item":"5886371971"},{"paintseed":"969","item":"12558348425"},{"paintseed":"74","item":"3172233681"},{"paintseed":"74","item":"10556433195"},{"paintseed":"74","item":"12525260728"},{"paintseed":"74","item":"7966182831"},{"paintseed":"163","item":"12860652585"},{"paintseed":"163","item":"10185060697"},{"paintseed":"163","item":"8037788050"},{"paintseed":"163","item":"12362543050"},{"paintseed":"163","item":"12024347919"},{"paintseed":"888","item":"12186202733"},{"paintseed":"888","item":"12615857250"},{"paintseed":"888","item":"12464521180"},{"paintseed":"888","item":"10946418106"},{"paintseed":"888","item":"4288168771"},{"paintseed":"888","item":"8776053832"},{"paintseed":"770","item":"10216699433"},{"paintseed":"695","item":"12594516488"},{"paintseed":"695","item":"9693097671"},{"paintseed":"695","item":"5668260496"},{"paintseed":"695","item":"6137049934"},{"paintseed":"695","item":"6939717965"},{"paintseed":"122","item":"10778404003"},{"paintseed":"122","item":"11588052676"},{"paintseed":"122","item":"12242466581"},{"paintseed":"122","item":"5760065891"},{"paintseed":"122","item":"7019098597"},{"paintseed":"122","item":"7060649172"},{"paintseed":"122","item":"5423240777"},{"paintseed":"122","item":"10225163559"},{"paintseed":"202","item":"4709122128"},{"paintseed":"202","item":"11720152504"},{"paintseed":"202","item":"11702306823"},{"paintseed":"202","item":"10192340647"},{"paintseed":"202","item":"7549549775"},{"paintseed":"202","item":"7539895517"},{"paintseed":"202","item":"8115453836"},{"paintseed":"202","item":"9253088327"},{"paintseed":"922","item":"12590472650"},{"paintseed":"922","item":"3763830012"},{"paintseed":"689","item":"732009253"},{"paintseed":"689","item":"6797823902"},{"paintseed":"689","item":"11874630505"},{"paintseed":"689","item":"11087619640"},{"paintseed":"689","item":"7203672274"},{"paintseed":"887","item":"12011826521"},{"paintseed":"887","item":"11177781027"},{"paintseed":"887","item":"10334573477"},{"paintseed":"887","item":"12700798992"},{"paintseed":"887","item":"9834865054"},{"paintseed":"887","item":"12367860049"},{"paintseed":"887","item":"6815524375"},{"paintseed":"887","item":"5051686444"},{"paintseed":"228","item":"12826220148"},{"paintseed":"228","item":"8178576434"},{"paintseed":"228","item":"9067203659"},{"paintseed":"228","item":"8303039183"},{"paintseed":"647","item":"8305475844"},{"paintseed":"647","item":"10025972444"},{"paintseed":"647","item":"749426297"},{"paintseed":"847","item":"6481695472"},{"paintseed":"847","item":"8938623497"},{"paintseed":"847","item":"12809857920"},{"paintseed":"847","item":"2947293925"},{"paintseed":"847","item":"12269378764"},{"paintseed":"847","item":"1221584237"},{"paintseed":"724","item":"10689354979"},{"paintseed":"724","item":"2267487040"},{"paintseed":"724","item":"12816397177"},{"paintseed":"724","item":"12928078120"},{"paintseed":"724","item":"10699144854"},{"paintseed":"724","item":"12250837413"},{"paintseed":"713","item":"12940871592"},{"paintseed":"713","item":"12926139397"},{"paintseed":"713","item":"12688452952"},{"paintseed":"430","item":"11777870430"},{"paintseed":"430","item":"11577472566"},{"paintseed":"200","item":"12674546718"},{"paintseed":"200","item":"7057699816"},{"paintseed":"200","item":"11740047684"},{"paintseed":"980","item":"6058775540"},{"paintseed":"980","item":"10002003227"},{"paintseed":"980","item":"11100490772"},{"paintseed":"82","item":"6812403160"},{"paintseed":"82","item":"11601245191"},{"paintseed":"173","item":"12665533764"},{"paintseed":"173","item":"10761782809"},{"paintseed":"173","item":"4204422361"},{"paintseed":"173","item":"10177185333"},{"paintseed":"173","item":"12065235224"},{"paintseed":"173","item":"913458549"},{"paintseed":"173","item":"12011972156"},{"paintseed":"428","item":"3986702253"},{"paintseed":"428","item":"1422051057"},{"paintseed":"428","item":"11737566177"},{"paintseed":"428","item":"12937695976"},{"paintseed":"428","item":"11787102412"},{"paintseed":"605","item":"7062549820"},{"paintseed":"525","item":"8315920008"},{"paintseed":"525","item":"8161343324"},{"paintseed":"879","item":"8592642605"},{"paintseed":"879","item":"4494741561"},{"paintseed":"879","item":"11167634348"},{"paintseed":"879","item":"12489093489"},{"paintseed":"879","item":"8079699554"},{"paintseed":"879","item":"7277906529"},{"paintseed":"628","item":"5383003916"},{"paintseed":"628","item":"11432852731"},{"paintseed":"628","item":"11620352540"},{"paintseed":"628","item":"5168428470"},{"paintseed":"628","item":"3347290241"},{"paintseed":"872","item":"11587146967"},{"paintseed":"872","item":"12835153543"},{"paintseed":"112","item":"12475477765"},{"paintseed":"112","item":"10521840564"},{"paintseed":"112","item":"7301396115"},{"paintseed":"112","item":"7090514761"},{"paintseed":"453","item":"5054017482"},{"paintseed":"453","item":"10360970514"},{"paintseed":"970","item":"8076953110"},{"paintseed":"970","item":"10495579286"},{"paintseed":"970","item":"12475792378"},{"paintseed":"325","item":"12696430196"},{"paintseed":"325","item":"11985419433"},{"paintseed":"325","item":"4050578709"},{"paintseed":"325","item":"12242278288"},{"paintseed":"325","item":"10492740435"},{"paintseed":"325","item":"11845769275"},{"paintseed":"325","item":"10189819771"},{"paintseed":"325","item":"12657009024"},{"paintseed":"325","item":"12829684380"},{"paintseed":"215","item":"4917810995"},{"paintseed":"215","item":"9966576889"},{"paintseed":"426","item":"12919603943"},{"paintseed":"426","item":"11447846887"},{"paintseed":"426","item":"2963314959"},{"paintseed":"169","item":"2463252638"},{"paintseed":"169","item":"9808542604"},{"paintseed":"566","item":"958831052"},{"paintseed":"566","item":"9691054156"},{"paintseed":"566","item":"12033835912"},{"paintseed":"566","item":"12323236894"},{"paintseed":"566","item":"10208406704"},{"paintseed":"566","item":"12778168001"},{"paintseed":"147","item":"12881168012"},{"paintseed":"147","item":"12836172122"},{"paintseed":"147","item":"12832149661"},{"paintseed":"147","item":"12098911606"},{"paintseed":"147","item":"9234196101"},{"paintseed":"381","item":"12250560083"},{"paintseed":"381","item":"12712579542"},{"paintseed":"216","item":"9354363832"},{"paintseed":"216","item":"11055294268"},{"paintseed":"216","item":"3584200463"},{"paintseed":"216","item":"12854690048"},{"paintseed":"319","item":"11770584247"},{"paintseed":"319","item":"9585166648"},{"paintseed":"319","item":"3261877791"},{"paintseed":"319","item":"8516183820"},{"paintseed":"319","item":"12774429027"},{"paintseed":"862","item":"10259088448"},{"paintseed":"862","item":"8738894940"},{"paintseed":"862","item":"12864250861"},{"paintseed":"862","item":"12270900585"},{"paintseed":"985","item":"6977721748"},{"paintseed":"985","item":"10627567957"},{"paintseed":"985","item":"10211739454"},{"paintseed":"985","item":"12321720943"},{"paintseed":"985","item":"9751134159"},{"paintseed":"985","item":"1440561752"},{"paintseed":"985","item":"11424005137"},{"paintseed":"450","item":"5729131646"},{"paintseed":"450","item":"9742000832"},{"paintseed":"450","item":"12225184501"},{"paintseed":"450","item":"8800177305"},{"paintseed":"450","item":"6529573037"},{"paintseed":"450","item":"8084081423"},{"paintseed":"733","item":"12345963554"},{"paintseed":"733","item":"12548224634"},{"paintseed":"733","item":"12813108157"},{"paintseed":"733","item":"8091661758"},{"paintseed":"935","item":"11407086668"},{"paintseed":"935","item":"5339914275"},{"paintseed":"935","item":"12306171936"},{"paintseed":"935","item":"2382394925"},{"paintseed":"13","item":"8900652584"},{"paintseed":"13","item":"11883809085"},{"paintseed":"9","item":"10586478090"},{"paintseed":"752","item":"2189541683"},{"paintseed":"752","item":"4889969142"},{"paintseed":"752","item":"12278241513"},{"paintseed":"752","item":"12199036164"},{"paintseed":"610","item":"11210650274"},{"paintseed":"512","item":"6798883515"},{"paintseed":"512","item":"6546042988"},{"paintseed":"512","item":"6818939397"},{"paintseed":"878","item":"8019615238"},{"paintseed":"878","item":"12467684721"},{"paintseed":"979","item":"10188465792"},{"paintseed":"979","item":"4131189526"},{"paintseed":"979","item":"10913481868"},{"paintseed":"979","item":"12370300714"},{"paintseed":"979","item":"12663024251"},{"paintseed":"979","item":"9805812736"},{"paintseed":"979","item":"12518144122"},{"paintseed":"979","item":"4347983754"},{"paintseed":"519","item":"12334165227"},{"paintseed":"519","item":"12508839134"},{"paintseed":"519","item":"12808255278"},{"paintseed":"519","item":"160515086"},{"paintseed":"627","item":"12663858454"},{"paintseed":"627","item":"10056570813"},{"paintseed":"627","item":"10231109997"},{"paintseed":"627","item":"9217901228"},{"paintseed":"627","item":"12930712334"},{"paintseed":"627","item":"5452814736"},{"paintseed":"627","item":"9834766647"},{"paintseed":"78","item":"10974032623"},{"paintseed":"78","item":"12670154857"},{"paintseed":"78","item":"8779951562"},{"paintseed":"78","item":"12581890906"},{"paintseed":"978","item":"12692490583"},{"paintseed":"978","item":"8185760363"},{"paintseed":"978","item":"11631409160"},{"paintseed":"978","item":"5805221465"},{"paintseed":"978","item":"6857238650"},{"paintseed":"978","item":"12028924870"},{"paintseed":"149","item":"5532284273"},{"paintseed":"149","item":"8158421981"},{"paintseed":"149","item":"9911021572"},{"paintseed":"149","item":"6706880176"},{"paintseed":"149","item":"12807552264"},{"paintseed":"310","item":"3226998333"},{"paintseed":"310","item":"12301583401"},{"paintseed":"310","item":"4100151623"},{"paintseed":"456","item":"795688579"},{"paintseed":"456","item":"9329409048"},{"paintseed":"456","item":"9699149839"},{"paintseed":"456","item":"11189749584"},{"paintseed":"413","item":"3481420765"},{"paintseed":"413","item":"3280040502"},{"paintseed":"894","item":"12120471499"},{"paintseed":"894","item":"2727601368"},{"paintseed":"894","item":"12133252191"},{"paintseed":"894","item":"9893887286"},{"paintseed":"894","item":"11650240142"},{"paintseed":"235","item":"9618240738"},{"paintseed":"235","item":"10135825324"},{"paintseed":"235","item":"3435896221"},{"paintseed":"429","item":"7886347872"},{"paintseed":"429","item":"12546639896"},{"paintseed":"429","item":"12614218957"},{"paintseed":"429","item":"6595485515"},{"paintseed":"429","item":"7223858918"},{"paintseed":"429","item":"6024321654"},{"paintseed":"429","item":"4820303892"},{"paintseed":"429","item":"4629741149"},{"paintseed":"690","item":"5916503718"},{"paintseed":"690","item":"4846281714"},{"paintseed":"690","item":"12734814070"},{"paintseed":"690","item":"7781582888"},{"paintseed":"690","item":"5340701812"},{"paintseed":"577","item":"3267676508"},{"paintseed":"577","item":"5420014814"},{"paintseed":"577","item":"10426690330"},{"paintseed":"577","item":"12802777444"},{"paintseed":"577","item":"6494985310"},{"paintseed":"577","item":"12885867594"},{"paintseed":"4","item":"2852262804"},{"paintseed":"4","item":"4512417199"},{"paintseed":"4","item":"11030669625"},{"paintseed":"4","item":"12736454866"},{"paintseed":"806","item":"12859735332"},{"paintseed":"806","item":"12813258549"},{"paintseed":"806","item":"11395612289"},{"paintseed":"806","item":"10093343011"},{"paintseed":"323","item":"8679701813"},{"paintseed":"323","item":"11702002861"},{"paintseed":"323","item":"12795937386"},{"paintseed":"323","item":"6611803434"},{"paintseed":"323","item":"9866985327"},{"paintseed":"323","item":"9951680023"},{"paintseed":"604","item":"4755224434"},{"paintseed":"604","item":"9967499351"},{"paintseed":"604","item":"4164009012"},{"paintseed":"205","item":"12845861324"},{"paintseed":"205","item":"12428568304"},{"paintseed":"481","item":"10045077736"},{"paintseed":"481","item":"10197547791"},{"paintseed":"481","item":"4859617951"},{"paintseed":"481","item":"4858281714"},{"paintseed":"481","item":"12470497977"},{"paintseed":"814","item":"6773657014"},{"paintseed":"137","item":"12897518373"},{"paintseed":"137","item":"12851811097"},{"paintseed":"137","item":"763241696"},{"paintseed":"137","item":"11710630390"},{"paintseed":"497","item":"6788767657"},{"paintseed":"497","item":"6155094418"},{"paintseed":"497","item":"10510958464"},{"paintseed":"961","item":"12745995123"},{"paintseed":"961","item":"12808891315"},{"paintseed":"278","item":"3558217472"},{"paintseed":"278","item":"4119547615"},{"paintseed":"278","item":"10475982902"},{"paintseed":"278","item":"12839813458"},{"paintseed":"278","item":"10136016280"},{"paintseed":"278","item":"8593216861"},{"paintseed":"220","item":"6922932321"},{"paintseed":"220","item":"6969849823"},{"paintseed":"220","item":"11926663994"},{"paintseed":"220","item":"5962011229"},{"paintseed":"754","item":"1845938001"},{"paintseed":"40","item":"7037425955"},{"paintseed":"40","item":"5199927524"},{"paintseed":"40","item":"12922758887"},{"paintseed":"558","item":"9387326767"},{"paintseed":"558","item":"6728549711"},{"paintseed":"558","item":"11912825278"},{"paintseed":"685","item":"12911017068"},{"paintseed":"685","item":"11649101826"},{"paintseed":"685","item":"12385817628"},{"paintseed":"463","item":"12938167759"},{"paintseed":"463","item":"12912450034"},{"paintseed":"463","item":"10068294882"},{"paintseed":"775","item":"12773197127"},{"paintseed":"775","item":"12433949078"},{"paintseed":"775","item":"9864712263"},{"paintseed":"775","item":"9652032872"},{"paintseed":"557","item":"8280746425"},{"paintseed":"557","item":"9837143545"},{"paintseed":"557","item":"12759315763"},{"paintseed":"586","item":"12817628544"},{"paintseed":"586","item":"882254956"},{"paintseed":"586","item":"9517638037"},{"paintseed":"366","item":"11386819633"},{"paintseed":"259","item":"6672870409"},{"paintseed":"259","item":"12608586952"},{"paintseed":"259","item":"12879309953"},{"paintseed":"259","item":"12829069645"},{"paintseed":"259","item":"12905227516"},{"paintseed":"390","item":"7441952085"},{"paintseed":"390","item":"8214309292"},{"paintseed":"390","item":"10502116315"},{"paintseed":"390","item":"8700793934"},{"paintseed":"390","item":"12596244579"},{"paintseed":"390","item":"9920262988"},{"paintseed":"948","item":"10824911078"},{"paintseed":"948","item":"9714686071"},{"paintseed":"948","item":"11702828029"},{"paintseed":"948","item":"7144033291"},{"paintseed":"948","item":"12894386538"},{"paintseed":"139","item":"9293639072"},{"paintseed":"139","item":"12774973180"},{"paintseed":"139","item":"5167575551"},{"paintseed":"768","item":"9530246030"},{"paintseed":"768","item":"6705234946"},{"paintseed":"768","item":"12732180386"},{"paintseed":"768","item":"11848111172"},{"paintseed":"571","item":"1186877702"},{"paintseed":"571","item":"11724138909"},{"paintseed":"571","item":"6944916397"},{"paintseed":"571","item":"7550440193"},{"paintseed":"454","item":"11056244069"},{"paintseed":"454","item":"5086159668"},{"paintseed":"454","item":"7684435035"},{"paintseed":"454","item":"11537077860"},{"paintseed":"454","item":"11628713496"},{"paintseed":"454","item":"6686922703"},{"paintseed":"174","item":"4090950630"},{"paintseed":"174","item":"10019063539"},{"paintseed":"174","item":"9649487498"},{"paintseed":"174","item":"12849192702"},{"paintseed":"174","item":"12715882587"},{"paintseed":"352","item":"12902459693"},{"paintseed":"352","item":"5748552630"},{"paintseed":"352","item":"4084764252"},{"paintseed":"352","item":"12881429549"},{"paintseed":"352","item":"10583427714"},{"paintseed":"352","item":"8902472640"},{"paintseed":"352","item":"8391658843"},{"paintseed":"520","item":"10551125828"},{"paintseed":"520","item":"10192984740"},{"paintseed":"520","item":"9070262045"},{"paintseed":"520","item":"10519152620"},{"paintseed":"520","item":"12497635479"},{"paintseed":"172","item":"12924026766"},{"paintseed":"172","item":"2440718858"},{"paintseed":"172","item":"5574882660"},{"paintseed":"172","item":"10992455330"},{"paintseed":"227","item":"11987766508"},{"paintseed":"227","item":"11608172276"},{"paintseed":"227","item":"11571233494"},{"paintseed":"227","item":"8155546233"},{"paintseed":"227","item":"10087301125"},{"paintseed":"227","item":"6988865811"},{"paintseed":"227","item":"9565976214"},{"paintseed":"126","item":"12901890876"},{"paintseed":"344","item":"6147849444"},{"paintseed":"344","item":"10579818586"},{"paintseed":"344","item":"8330079047"},{"paintseed":"344","item":"6380878811"},{"paintseed":"344","item":"11100411670"},{"paintseed":"708","item":"7071026060"},{"paintseed":"708","item":"6610735183"},{"paintseed":"708","item":"12924517107"},{"paintseed":"708","item":"859086859"},{"paintseed":"708","item":"12455840454"},{"paintseed":"681","item":"11883995687"},{"paintseed":"681","item":"10516689499"},{"paintseed":"681","item":"12578981114"},{"paintseed":"681","item":"12931215939"},{"paintseed":"681","item":"12276872330"},{"paintseed":"350","item":"12169804563"},{"paintseed":"350","item":"4132950707"},{"paintseed":"350","item":"6136518913"},{"paintseed":"350","item":"1478674302"},{"paintseed":"350","item":"12500674914"},{"paintseed":"727","item":"11919777899"},{"paintseed":"727","item":"9536492532"},{"paintseed":"727","item":"12310929375"},{"paintseed":"727","item":"12183446907"},{"paintseed":"286","item":"6651605130"},{"paintseed":"286","item":"3266805266"},{"paintseed":"286","item":"8426769849"},{"paintseed":"286","item":"12571832404"},{"paintseed":"631","item":"4898173158"},{"paintseed":"631","item":"4465610119"},{"paintseed":"631","item":"12573706684"},{"paintseed":"631","item":"3829998281"},{"paintseed":"631","item":"12739507336"},{"paintseed":"631","item":"6876415108"},{"paintseed":"631","item":"9718187110"},{"paintseed":"631","item":"9561072262"},{"paintseed":"470","item":"5720677577"},{"paintseed":"470","item":"8373716897"},{"paintseed":"470","item":"11985525190"},{"paintseed":"261","item":"12009413388"},{"paintseed":"261","item":"12807674255"},{"paintseed":"261","item":"4217553968"},{"paintseed":"261","item":"3446367618"},{"paintseed":"795","item":"3810775634"},{"paintseed":"795","item":"12671776596"},{"paintseed":"795","item":"6298081128"},{"paintseed":"648","item":"10982598175"},{"paintseed":"648","item":"7740594039"},{"paintseed":"648","item":"12825203668"},{"paintseed":"648","item":"2602315159"},{"paintseed":"886","item":"3561802784"},{"paintseed":"886","item":"12884340710"},{"paintseed":"886","item":"8801896946"},{"paintseed":"886","item":"5492815847"},{"paintseed":"886","item":"12823666059"},{"paintseed":"886","item":"12261001995"},{"paintseed":"397","item":"12642666717"},{"paintseed":"397","item":"12735942180"},{"paintseed":"375","item":"7865617787"},{"paintseed":"375","item":"10315450221"},{"paintseed":"375","item":"10785224919"},{"paintseed":"375","item":"12847547468"},{"paintseed":"375","item":"9221906020"},{"paintseed":"375","item":"12843111473"},{"paintseed":"375","item":"7034578659"},{"paintseed":"849","item":"12231440359"},{"paintseed":"849","item":"9912611883"},{"paintseed":"849","item":"11083587968"},{"paintseed":"575","item":"9934575105"},{"paintseed":"575","item":"7350480019"},{"paintseed":"575","item":"9177587663"},{"paintseed":"575","item":"8576486483"},{"paintseed":"575","item":"10815291162"},{"paintseed":"575","item":"12841791370"},{"paintseed":"2","item":"2950467922"},{"paintseed":"2","item":"12809890108"},{"paintseed":"2","item":"6407149662"},{"paintseed":"2","item":"11134009047"},{"paintseed":"2","item":"12910739620"},{"paintseed":"113","item":"6803672454"},{"paintseed":"113","item":"7144856790"},{"paintseed":"856","item":"9895276823"},{"paintseed":"856","item":"7051435967"},{"paintseed":"856","item":"6888791344"},{"paintseed":"856","item":"12774632667"},{"paintseed":"856","item":"2895757081"},{"paintseed":"856","item":"12288871523"},{"paintseed":"856","item":"7644927824"},{"paintseed":"240","item":"11559257922"},{"paintseed":"240","item":"12489091650"},{"paintseed":"240","item":"11239967585"},{"paintseed":"333","item":"12893348989"},{"paintseed":"333","item":"12120471828"},{"paintseed":"333","item":"6445958825"},{"paintseed":"333","item":"12890442923"},{"paintseed":"88","item":"12418168526"},{"paintseed":"88","item":"12852866459"}]');
        foreach ($patterns as $pattern){
                Paintseed::create(['item_id' => $pattern->item, 'value' => $pattern->paintseed]);
        }

        return 'OK';
    }

    public function getSteam()
    {
        $tasks = Task::with('item')->where('pattern', '!=', null)->where('client', '=', 'ska4an')
            ->where('site_id', '=', '7')->get();

        $paintseeds = [];
        foreach ($tasks as $task){
            $paterns = $task->item->patterns->where('name', '=', $task->pattern)->toArray();
            foreach ($paterns as $patern){
                $paintseeds[] = $patern['value'];

            }
        }
        $steam_ids = DB::table('paintseeds')->whereIn('value',$paintseeds)->distinct()->pluck('item_id')->toArray();

        return json_encode($steam_ids);

    }
}
