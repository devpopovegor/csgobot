<?php

namespace App\Http\Controllers;

use App\Item;
use App\Paintseed;
use App\Pattern;
use App\Steam;
use App\Task;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class TestController extends Controller
{
	public function set_steams_task($id)
	{

		dd($id);

		$tasks = Task::with('item')->where('site_id', '=', $id)
		             ->where('pattern','!=', '')->get();

		foreach ($tasks as $task){
			$arr = array_unique($task->item->patterns->where('name', '=', $task->pattern)->pluck('value')->toArray());
			$arr = $task->item->paintseeds->whereIn('value', $arr)->pluck('item_id')->toArray();
			foreach ($arr as $item){
				Steam::create(['steam_id' => $item, 'task_id' => $task->id]);
			}
		}

		return 'ok';
	}

	public function set_patterns_name()
	{

//		dd(Paintseed::where('pattern_name', '!=', null)->distinct()->count());
		set_time_limit(0);
		$patterns = Pattern::all();
		foreach ($patterns as $pattern){
			$paintseeds = Paintseed::where('item_id', '=', $pattern->item_id)->where('value', '=', $pattern->value)->get();
			if (count($paintseeds)) {
				foreach ($paintseeds as $paintseed){
					$paintseed->pattern_name =  $pattern->name;
					$paintseed->save();
				}
//				$pattern->delete();
			}
		}
	}

	public function get_patterns()
    {
        set_time_limit(0);
        $json = json_encode(Pattern::with('item')->get());
        $json = str_replace('\u2605', '★', $json);
        $json = str_replace('\u2122','™', $json);
        return $json;
    }

    public function delete_patterns()
    {
		dd(2);
        DB::table('paintseeds')->delete();
    }

    public function set_patterns()
    {

//        dd(1);
        set_time_limit(0);
        $patterns = json_decode('[{"steam":11053053058,"float":0.000546456256415695,"value":95,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11057960702,"float":0.000695719092618674,"value":611,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11830080072,"float":0.001586412312462926,"value":220,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13027217306,"float":0.001806671847589314,"value":715,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10764272909,"float":0.002489745384082198,"value":348,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12999637620,"float":0.0034162094816565514,"value":824,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12534939261,"float":0.004933081101626158,"value":807,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10328114775,"float":0.005209180060774088,"value":807,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11632246472,"float":0.005509295500814915,"value":771,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11022852832,"float":0.006482609547674656,"value":532,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11174124783,"float":0.006488801911473274,"value":724,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11094853046,"float":0.006757273338735104,"value":293,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12133382987,"float":0.006826176308095455,"value":683,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12583662098,"float":0.0068316045217216015,"value":947,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10021533821,"float":0.006874468177556992,"value":860,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8681137195,"float":0.006888736970722675,"value":481,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10217751420,"float":0.006910359486937523,"value":274,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12728159902,"float":0.0069602131843566895,"value":735,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":7239761160,"float":0.006964830216020346,"value":824,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13035019486,"float":0.007672746200114489,"value":680,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11973381260,"float":0.007750986609607935,"value":967,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10052470958,"float":0.008050813339650631,"value":899,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9973004000,"float":0.008143123239278793,"value":383,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12536922274,"float":0.00828116200864315,"value":154,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11970826421,"float":0.00873298104852438,"value":660,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9696199228,"float":0.008889367803931236,"value":634,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11595182043,"float":0.00902422796934843,"value":254,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12929567263,"float":0.00912073440849781,"value":969,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11485933112,"float":0.009239190258085728,"value":412,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10331799904,"float":0.009427430108189583,"value":579,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11107221177,"float":0.00946916826069355,"value":880,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12272904584,"float":0.00948724802583456,"value":988,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9028553290,"float":0.00953763909637928,"value":864,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11862117647,"float":0.009732682257890701,"value":158,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12502384680,"float":0.009769349358975887,"value":488,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12388909836,"float":0.009841331280767918,"value":998,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11088216879,"float":0.010038044303655624,"value":661,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11385001116,"float":0.010150634683668613,"value":533,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9122398986,"float":0.01030188612639904,"value":870,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12859153843,"float":0.010419932194054127,"value":807,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9365227896,"float":0.010637114755809307,"value":311,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10123959490,"float":0.010643013752996922,"value":947,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12963121367,"float":0.01083182543516159,"value":157,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12804712416,"float":0.010920231230556965,"value":534,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11957487883,"float":0.011386450380086899,"value":423,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12258740720,"float":0.011447260156273842,"value":949,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12546449120,"float":0.011648056097328663,"value":717,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12082801635,"float":0.01188423577696085,"value":77,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":7393905849,"float":0.013552972115576267,"value":123,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12614467183,"float":0.013571151532232761,"value":360,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12473860347,"float":0.01407879963517189,"value":941,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9984740713,"float":0.01418947335332632,"value":152,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8526349174,"float":0.014360761269927025,"value":211,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13073179853,"float":0.014672447927296162,"value":482,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8565308870,"float":0.014759751968085766,"value":239,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10279345499,"float":0.015777796506881714,"value":440,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12333236426,"float":0.015904821455478668,"value":703,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13106250497,"float":0.01605084352195263,"value":281,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9170147188,"float":0.016259929165244102,"value":500,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10141003553,"float":0.016461901366710663,"value":841,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10980227096,"float":0.01680135540664196,"value":893,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12615792150,"float":0.01681963913142681,"value":256,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13091115544,"float":0.01722211390733719,"value":364,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12987104206,"float":0.01737077906727791,"value":577,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12034253675,"float":0.01767161302268505,"value":694,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11127857492,"float":0.017845241352915764,"value":15,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12102613280,"float":0.017907271161675453,"value":381,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8750543332,"float":0.018000060692429543,"value":471,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12894626627,"float":0.01803356222808361,"value":870,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11540069758,"float":0.01805170066654682,"value":421,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13109627524,"float":0.01815490983426571,"value":735,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13004850200,"float":0.01824294775724411,"value":689,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12636614508,"float":0.018255220726132393,"value":713,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12125962580,"float":0.0183049775660038,"value":986,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10859634259,"float":0.018319789320230484,"value":120,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12285447335,"float":0.018328092992305756,"value":197,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9201556469,"float":0.018690943717956543,"value":950,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8338879631,"float":0.018965601921081543,"value":324,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12819574063,"float":0.01954646408557892,"value":970,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9616814084,"float":0.019700495526194572,"value":807,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10853288078,"float":0.020005352795124054,"value":237,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13025821651,"float":0.020152432844042778,"value":547,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12189589173,"float":0.020214473828673363,"value":532,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12613649614,"float":0.020229514688253403,"value":113,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12862725071,"float":0.020361023023724556,"value":436,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12316868399,"float":0.020633239299058914,"value":835,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13034127367,"float":0.02066653035581112,"value":87,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12576969127,"float":0.02110440656542778,"value":248,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12634136318,"float":0.021383754909038544,"value":613,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9769198991,"float":0.021581845358014107,"value":117,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10922370446,"float":0.021843381226062775,"value":300,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13037100113,"float":0.021863384172320366,"value":588,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13061016297,"float":0.021865317597985268,"value":181,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13042071498,"float":0.021912511438131332,"value":148,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12099729246,"float":0.02204594947397709,"value":512,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12906390533,"float":0.022067107260227203,"value":126,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11042786991,"float":0.02209334261715412,"value":713,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13099433291,"float":0.022284885868430138,"value":776,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12506634353,"float":0.02237885631620884,"value":117,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10105709488,"float":0.02274511195719242,"value":899,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10105709488,"float":0.02274511195719242,"value":899,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9685384800,"float":0.022867674008011818,"value":209,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11087109542,"float":0.023357119411230087,"value":890,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13059100880,"float":0.02373761124908924,"value":578,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12785249069,"float":0.023933056741952896,"value":410,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13106251024,"float":0.02404683083295822,"value":171,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12192681501,"float":0.024052945896983147,"value":203,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12734464986,"float":0.0241114292293787,"value":816,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12015737346,"float":0.02420872636139393,"value":393,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12523384292,"float":0.024307455867528915,"value":900,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13005295882,"float":0.024682573974132538,"value":333,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12560365751,"float":0.024771999567747116,"value":112,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12916490837,"float":0.024977674707770348,"value":946,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12166627537,"float":0.025045013055205345,"value":33,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12754394688,"float":0.025211423635482788,"value":369,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12532361508,"float":0.025678962469100952,"value":800,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11709759448,"float":0.025738874450325966,"value":954,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11111583836,"float":0.025941161438822746,"value":373,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9132639720,"float":0.02603907138109207,"value":478,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13072329167,"float":0.02658948116004467,"value":900,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12893759809,"float":0.027991728857159615,"value":853,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":7449058237,"float":0.028035949915647507,"value":881,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12699306149,"float":0.028107354417443275,"value":174,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8455305730,"float":0.02831570990383625,"value":84,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12972489487,"float":0.02848789654672146,"value":124,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12754394670,"float":0.028552627190947533,"value":56,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13098093028,"float":0.028873195871710777,"value":372,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9762412730,"float":0.029437044635415077,"value":811,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13080256613,"float":0.029475804418325424,"value":356,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12365451027,"float":0.02949187159538269,"value":686,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8084531831,"float":0.030218150466680527,"value":446,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11455709934,"float":0.031206786632537842,"value":722,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9668622879,"float":0.03122561424970627,"value":700,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12745543251,"float":0.031533971428871155,"value":545,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11686317650,"float":0.031628914177417755,"value":624,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10359068299,"float":0.03167177736759186,"value":402,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12922780030,"float":0.03170067071914673,"value":433,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10866846037,"float":0.03193167597055435,"value":815,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11660647260,"float":0.03193466365337372,"value":870,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12996913752,"float":0.03198147565126419,"value":758,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9901769978,"float":0.032075926661491394,"value":351,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12412137941,"float":0.032082948833703995,"value":816,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13037202356,"float":0.032087478786706924,"value":35,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10815910896,"float":0.032212886959314346,"value":284,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11257003919,"float":0.03223533183336258,"value":112,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12733637131,"float":0.03234022855758667,"value":800,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13097161563,"float":0.03240680322051048,"value":484,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12836635222,"float":0.03261633962392807,"value":36,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13034464902,"float":0.03266995772719383,"value":299,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12731549661,"float":0.032723285257816315,"value":373,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12442214692,"float":0.032778315246105194,"value":368,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12330639999,"float":0.033066052943468094,"value":991,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9789841159,"float":0.033181726932525635,"value":417,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10885653219,"float":0.033252134919166565,"value":917,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10946945828,"float":0.03335576504468918,"value":934,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12822977883,"float":0.033449918031692505,"value":278,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":7835308907,"float":0.03345246985554695,"value":170,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11106385349,"float":0.03360137715935707,"value":761,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12725628428,"float":0.03374043479561806,"value":574,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13099341842,"float":0.03383054584264755,"value":234,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13095877175,"float":0.03385889157652855,"value":322,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13097268403,"float":0.03387096896767616,"value":623,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10893101285,"float":0.033967334777116776,"value":917,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13048259170,"float":0.034183476120233536,"value":824,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12813921670,"float":0.03418787568807602,"value":952,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9165544661,"float":0.03427908197045326,"value":117,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10125493679,"float":0.034423138946294785,"value":829,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12793835323,"float":0.034644730389118195,"value":730,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12937815064,"float":0.034689269959926605,"value":891,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11944402349,"float":0.034723665565252304,"value":583,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12997939301,"float":0.03492939472198486,"value":670,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12623746522,"float":0.03493960574269295,"value":299,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12108086095,"float":0.034967515617609024,"value":352,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9379429685,"float":0.03501523286104202,"value":400,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8705006183,"float":0.035050731152296066,"value":6,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12956332913,"float":0.03528032824397087,"value":543,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11122040009,"float":0.03536601364612579,"value":985,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12615063520,"float":0.035469718277454376,"value":672,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12753886758,"float":0.03567993640899658,"value":17,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9925562930,"float":0.03572181612253189,"value":903,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":10051997070,"float":0.03590298071503639,"value":348,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13018809134,"float":0.0359981544315815,"value":316,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13116231129,"float":0.03725118190050125,"value":761,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12787321046,"float":0.03957130014896393,"value":266,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13028454439,"float":0.040990520268678665,"value":805,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13028770836,"float":0.04152950271964073,"value":16,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12939493065,"float":0.042538776993751526,"value":56,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12370978523,"float":0.04280095919966698,"value":868,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12939068316,"float":0.04514946788549423,"value":494,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13110149077,"float":0.045431241393089294,"value":437,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13112763097,"float":0.04768768697977066,"value":912,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":9311088270,"float":0.04849355295300484,"value":69,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13112648570,"float":0.05071118846535683,"value":365,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13096048926,"float":0.051594752818346024,"value":463,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12326242330,"float":0.052619569003582,"value":808,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13023231852,"float":0.05293884500861168,"value":516,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12552581085,"float":0.05353809893131256,"value":504,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11778336282,"float":0.056109897792339325,"value":402,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12817809902,"float":0.05837182328104973,"value":238,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13108035933,"float":0.05858321115374565,"value":761,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13108035933,"float":0.05858321115374565,"value":761,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12686214930,"float":0.060597967356443405,"value":773,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":13043026422,"float":0.06112011894583702,"value":236,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12811113424,"float":0.06176171079277992,"value":576,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12811062589,"float":0.06479888409376144,"value":160,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":8747203920,"float":0.06868330389261246,"value":81,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12954660462,"float":0.06900560855865479,"value":578,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":12971590182,"float":0.06918781250715256,"value":977,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Factory New)"},{"steam":11352073732,"float":0.0716761127114296,"value":375,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Minimal Wear)"},{"steam":8760181766,"float":0.07225611805915833,"value":82,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Minimal Wear)"},{"steam":10977774715,"float":0.07305163890123367,"value":91,"item_name":"★ M9 Bayonet | Gamma Doppler Emerald (Minimal Wear)"},{"steam":12723334529,"float":0.07548429816961288,"value":792,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Minimal Wear)"},{"steam":12723334529,"float":0.07548429816961288,"value":792,"item_name":"★ StatTrak™ M9 Bayonet | Gamma Doppler Emerald (Minimal Wear)"}]');
        foreach ($patterns as $pattern){
            $item_id = Item::where('full_name', '=', $pattern->item_name)->first();
            if ($item_id) {
                $item_id = $item_id->id;
                $val = '1001';
                try {
                    $val = $pattern->value;
                } catch (\Exception $exception) {
                }
                Paintseed::create(['item_id' => $item_id, 'value' => $val,
                    'steam' => $pattern->steam, 'float' => $pattern->float, 'pattern_name' => null]);
            }
        }

        return 'OK';
    }

    public function get_tasks($site_id, $username)
    {
        set_time_limit(0);
        $tasks = Task::with('item.paintseeds')->where('site_id', '=', $site_id)
            ->where('client','=', $username)->get();

        $result = [];
        foreach ($tasks as $task) {
            $paintseeds = $task->item->paintseeds;
            if ($task->float) $paintseeds = $paintseeds->where('float', '<=', $task->float);
            if ($task->pattern) $paintseeds = $paintseeds->where('pattern_name', '=', $task->pattern);
            $paintseeds = $paintseeds->pluck('steam')->toArray();
            $result[$task->id] = $paintseeds;
        }

        dd($result);

//        return json_encode($result);
    }

}